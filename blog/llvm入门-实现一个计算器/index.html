<!DOCTYPE html><html lang="zh" class="no-js"><head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="热爱编程和阅读，学无止境">
      
      
        <meta name="author" content="SteveForever">
      
      
        <link rel="canonical" href="https://github.com/KenForever1/blog/llvm%E5%85%A5%E9%97%A8-%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E8%AE%A1%E7%AE%97%E5%99%A8/">
      
      
        <link rel="prev" href="../c%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8mix-in%E6%A8%A1%E5%BC%8F%E7%81%B5%E6%B4%BB%E5%8F%AF%E6%89%A9%E5%B1%95%E7%9A%84%E7%BB%84%E5%90%88%E5%8A%9F%E8%83%BD/">
      
      
        <link rel="next" href="../%E4%BB%8Edeepseek%E5%BC%80%E6%BA%90%E5%BA%933fs%E4%B8%AD%E5%AD%A6%E4%B9%A0fuse%E7%9A%84%E4%BD%BF%E7%94%A8-%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%80/">
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS 订阅" href="../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="已更新内容的 RSS 订阅" href="../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../assets/logo.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>LLVM入门-实现一个计算器 - KenForever1</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.e53b48f4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
    
    
    
   <meta name="baidu-site-verification" content="codeva-hJH2gPjZkn">

  <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#如何编写一个llvm-pass" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="KenForever1" class="md-header__button md-logo" aria-label="KenForever1" data-md-component="logo">
      
  <img src="../../assets/octocat.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            KenForever1
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              LLVM入门-实现一个计算器
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="indigo" aria-label="Switch to dark mode" type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7.5 2c-1.79 1.15-3 3.18-3 5.5s1.21 4.35 3.03 5.5C4.46 13 2 10.54 2 7.5A5.5 5.5 0 0 1 7.5 2m11.57 1.5 1.43 1.43L4.93 20.5 3.5 19.07zm-6.18 2.43L11.41 5 9.97 6l.42-1.7L9 3.24l1.75-.12.58-1.65L12 3.1l1.73.03-1.35 1.13zm-3.3 3.61-1.16-.73-1.12.78.34-1.32-1.09-.83 1.36-.09.45-1.29.51 1.27 1.36.03-1.05.87zM19 13.5a5.5 5.5 0 0 1-5.5 5.5c-1.22 0-2.35-.4-3.26-1.07l7.69-7.69c.67.91 1.07 2.04 1.07 3.26m-4.4 6.58 2.77-1.15-.24 3.35zm4.33-2.7 1.15-2.77 2.2 2.54zm1.15-4.96-1.14-2.78 3.34.24zM9.63 18.93l2.77 1.15-2.53 2.19z"></path></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="grey" data-md-color-accent="indigo" aria-label="Switch to light mode" type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7.5 2c-1.79 1.15-3 3.18-3 5.5s1.21 4.35 3.03 5.5C4.46 13 2 10.54 2 7.5A5.5 5.5 0 0 1 7.5 2m11.57 1.5 1.43 1.43L4.93 20.5 3.5 19.07zm-6.18 2.43L11.41 5 9.97 6l.42-1.7L9 3.24l1.75-.12.58-1.65L12 3.1l1.73.03-1.35 1.13zm-3.3 3.61-1.16-.73-1.12.78.34-1.32-1.09-.83 1.36-.09.45-1.29.51 1.27 1.36.03-1.05.87zM19 13.5a5.5 5.5 0 0 1-5.5 5.5c-1.22 0-2.35-.4-3.26-1.07l7.69-7.69c.67.91 1.07 2.04 1.07 3.26m-4.4 6.58 2.77-1.15-.24 3.35zm4.33-2.7 1.15-2.77 2.2 2.54zm1.15-4.96-1.14-2.78 3.34.24zM9.63 18.93l2.77 1.15-2.53 2.19z"></path></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/KenForever1" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
  </div>
  <div class="md-source__repository">
    KenForever1
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
    
  
  博客

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../weeks/%E8%A7%A3%E9%94%81%E9%AB%98%E6%95%88%E5%A4%A7%E8%A7%84%E6%A8%A1%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83%EF%BC%9A%E5%BC%A0%E9%87%8F%E5%B9%B6%E8%A1%8C%28TP%29%E6%8A%80%E6%9C%AF/" class="md-tabs__link">
          
  
  
    
  
  杂谈杂记

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../notes/%23%E8%B0%83%E8%AF%95%E6%8A%80%E8%83%BD%E7%AF%87/%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7/" class="md-tabs__link">
          
  
  
    
  
  技术

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  关于我

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="KenForever1" class="md-nav__button md-logo" aria-label="KenForever1" data-md-component="logo">
      
  <img src="../../assets/octocat.png" alt="logo">

    </a>
    KenForever1
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/KenForever1" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
  </div>
  <div class="md-source__repository">
    KenForever1
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    博客
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            博客
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2">
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    归档
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            归档
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../archive/2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2025
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../archive/2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2024
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3">
        
          
          <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    分类
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_3">
            <span class="md-nav__icon md-icon"></span>
            分类
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/c/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    C++
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/gnu/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GNU
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/llm%E6%8E%A8%E7%90%86/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LLM推理
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/ai/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ai
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/cpp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cpp
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/ebpf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ebpf
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/git/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    git
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/http-proxy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    http proxy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/libcurl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    libcurl
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/linux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    linux
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/llm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    llm
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/llvm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    llvm
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/netcap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    netcap
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/openai/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    openai
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/proxychains/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    proxychains
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/python/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    python
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/rust/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    rust
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/squid/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    squid
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/vim/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    vim
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    开发工具
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/%E5%BC%80%E5%8F%91%E6%8A%80%E8%83%BD/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    开发技能
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/%E6%BA%90%E7%A0%81%E5%AE%9E%E7%8E%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    源码实现
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/%E7%AE%97%E6%B3%95/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    算法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/%E7%BC%96%E7%A8%8B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    编程
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/%E9%98%9F%E5%88%97/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    队列
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../category/%E9%AB%98%E6%80%A7%E8%83%BD%E5%A4%9A%E7%BA%BF%E7%A8%8B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    高性能多线程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2">
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    杂谈杂记
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            杂谈杂记
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../weeks/%E8%A7%A3%E9%94%81%E9%AB%98%E6%95%88%E5%A4%A7%E8%A7%84%E6%A8%A1%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83%EF%BC%9A%E5%BC%A0%E9%87%8F%E5%B9%B6%E8%A1%8C%28TP%29%E6%8A%80%E6%9C%AF/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    解锁高效大规模模型训练：张量并行(TP)技术
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../weeks/%E8%A7%A3%E5%86%B3linux%E4%B8%8D%E8%83%BD%E8%BE%93%E5%85%A5%E6%B1%89%E5%AD%97%E4%BB%A5%E5%8F%8A%E6%B1%89%E5%AD%97%E6%98%BE%E7%A4%BA%E4%B9%B1%E7%A0%81/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    解决linux不能输入汉字以及汉字显示乱码
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../weeks/%E7%BC%96%E8%AF%91Opencv%E5%92%8CFFmpeg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    编译Opencv和FFmpeg
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../weeks/%E5%9F%BA%E4%BA%8EDocusaurus%E6%90%AD%E5%BB%BAgithub_pages%E5%B1%95%E7%A4%BA%E9%A1%B9%E7%9B%AE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    基于Docusaurus搭建github pages展示项目
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../weeks/%E4%BB%8B%E7%BB%8D%E8%A1%A5%E7%A0%81%E7%9A%84%E4%B8%80%E7%AF%87%E5%BE%88%E5%A5%BD%E7%9A%84%E6%96%87%E7%AB%A0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    介绍补码的一篇很好的文章
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../weeks/python%E5%A6%82%E4%BD%95%E7%94%9F%E6%88%90%E8%B0%83%E7%94%A8%E5%9B%BEcall_graph/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    python调用图
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../weeks/float%E8%BD%ACstring%E7%B2%BE%E5%BA%A6%E6%8D%9F%E5%A4%B1%E9%97%AE%E9%A2%98/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Float转string精度损失问题
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../weeks/docker%E6%8B%89%E9%95%9C%E5%83%8F%E5%A4%AA%E6%85%A2%E4%BA%86/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    docker镜像加速方法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../weeks/c%2B%2B%E5%8D%95%E6%B5%8B%E8%A6%86%E7%9B%96%E7%8E%87%E8%BF%87%E4%BD%8E/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    C++单测覆盖率过低
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../weeks/base64%E5%8E%9F%E7%90%86/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Base64原理
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../weeks/babylon%E5%B7%B4%E6%AF%94%E4%BC%A6%E7%9A%84%E5%B7%A5%E7%A8%8B%E5%B8%88/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    c++开源库和文章分享
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../weeks/SRAM%E5%92%8CDRAM/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SRAM和DRAM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../weeks/C%2B%2B%E6%9D%A1%E4%BB%B6%E7%BC%96%E8%AF%91/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    C++条件编译
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../weeks/C%2B%2B%E5%8D%95%E6%B5%8BMock%E6%96%B9%E5%BC%8F/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    C++单测Mock方式
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../weeks/20241117-llama-cpp%E6%8F%90%E7%82%B9PR/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    给llama-cpp提交一些PR
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3">
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    技术
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            技术
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1">
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    #调试技能篇
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            #调试技能篇
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E8%B0%83%E8%AF%95%E6%8A%80%E8%83%BD%E7%AF%87/%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    调试工具
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E8%B0%83%E8%AF%95%E6%8A%80%E8%83%BD%E7%AF%87/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    性能分析
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_3">
        
          
          <label class="md-nav__link" for="__nav_3_1_3" id="__nav_3_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Gdb
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_3">
            <span class="md-nav__icon md-icon"></span>
            Gdb
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E8%B0%83%E8%AF%95%E6%8A%80%E8%83%BD%E7%AF%87/gdb/use%20gdb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Use gdb
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E8%B0%83%E8%AF%95%E6%8A%80%E8%83%BD%E7%AF%87/gdb/gdb%E8%B0%83%E8%AF%95core%E6%96%87%E4%BB%B6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Gdb调试core文件
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E8%B0%83%E8%AF%95%E6%8A%80%E8%83%BD%E7%AF%87/gdb/gdb%E6%9B%B4%E5%A5%BD%E7%9A%84%E6%98%BE%E7%A4%BAc%2B%2B%20STL%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%9A%84%E5%80%BC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gdb更好的显示c++ STL数据结构的值
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E8%B0%83%E8%AF%95%E6%8A%80%E8%83%BD%E7%AF%87/gcc%E7%89%88%E6%9C%AC%E4%BE%9D%E8%B5%96ELF%E4%BF%AE%E6%94%B9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linux修改ELF解决glibc兼容性问题
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_5">
        
          
          <label class="md-nav__link" for="__nav_3_1_5" id="__nav_3_1_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Ebpf
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_5">
            <span class="md-nav__icon md-icon"></span>
            Ebpf
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E8%B0%83%E8%AF%95%E6%8A%80%E8%83%BD%E7%AF%87/ebpf/ebpf%20udst%E5%88%9D%E6%8E%A2--libstapsdt%E7%9A%84%E4%BD%BF%E7%94%A8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ebpf udst初探  libstapsdt的使用
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E8%B0%83%E8%AF%95%E6%8A%80%E8%83%BD%E7%AF%87/Python%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Python调试工具
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2">
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    #编程语言篇
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            #编程语言篇
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_1">
        
          
          <label class="md-nav__link" for="__nav_3_2_1" id="__nav_3_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Rust
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_1">
            <span class="md-nav__icon md-icon"></span>
            Rust
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/Rust/%E5%9C%A8Linux%E4%B8%8A%E7%BC%96%E8%AF%91Windows%E5%B9%B3%E5%8F%B0%E7%9A%84Rust%E7%A8%8B%E5%BA%8F/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    在Linux上编译Windows平台的Rust程序
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/Rust/rust%20corse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Rust corse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/Rust/Rust%E7%AF%87/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Rust篇
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/Rust/Advent_of_code_2020--%E7%99%BB%E6%9C%BA%E5%BA%A7%E4%BD%8D%E9%97%AE%E9%A2%98/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Advent of code 2020 -- 登机座位问题
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_2">
        
          
          <label class="md-nav__link" for="__nav_3_2_2" id="__nav_3_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Python
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_2">
            <span class="md-nav__icon md-icon"></span>
            Python
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/Python/Python/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Python
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_2_2">
        
          
          <label class="md-nav__link" for="__nav_3_2_2_2" id="__nav_3_2_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    PyQt技法
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_2_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_2_2">
            <span class="md-nav__icon md-icon"></span>
            PyQt技法
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/Python/PyQt%E6%8A%80%E6%B3%95/tabWidget%20in%20pyqt5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tabWidget in pyqt5
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/Python/PyQt%E6%8A%80%E6%B3%95/qt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Qt
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/Python/PyQt%E6%8A%80%E6%B3%95/qt5-code-snippet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Qt5 code snippet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/Python/PyQt%E6%8A%80%E6%B3%95/pyqt%20qss%20problem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pyqt qss problem
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/Python/PyQt%E6%8A%80%E6%B3%95/pyqt5-tableWidget/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pyqt5 tableWidget
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/Python/PyQt%E6%8A%80%E6%B3%95/pyqt5-package-to-deb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pyqt5 package to deb
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/Python/PyQt%E6%8A%80%E6%B3%95/pyqt5-eric6-pycharm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pyqt5 eric6 pycharm
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/Python/PyQt%E6%8A%80%E6%B3%95/pyqt5-add-resource-file/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pyqt5 add resource file
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/Python/PyQt%E6%8A%80%E6%B3%95/pyQt%20style%20Pattern/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pyQt style Pattern
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/Python/PyQt%E6%8A%80%E6%B3%95/TreeView%20of%20PyQt5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TreeView of PyQt5
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/Python/PyQt%E6%8A%80%E6%B3%95/QtDev/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    QtDev
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/Python/PyQt%E6%8A%80%E6%B3%95/NetworkGraph%20add%20self%20loop%20edge%20of%20PyQt5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NetworkGraph add self loop edge of PyQt5
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/Python/PyQt%E6%8A%80%E6%B3%95/Network%20Graph%20of%20PyQt5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Network Graph of PyQt5
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/Kotlin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kotlin
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_4">
        
          
          <label class="md-nav__link" for="__nav_3_2_4" id="__nav_3_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    FFI跨语言调用
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_4">
            <span class="md-nav__icon md-icon"></span>
            FFI跨语言调用
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/FFI%E8%B7%A8%E8%AF%AD%E8%A8%80%E8%B0%83%E7%94%A8/python%E8%B0%83%E7%94%A8c%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    python调用c踩坑记录
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/FFI%E8%B7%A8%E8%AF%AD%E8%A8%80%E8%B0%83%E7%94%A8/ctypes%E5%9C%B0%E5%9D%80%E4%BC%A0%E9%80%92%E6%88%AA%E6%96%AD%E9%97%AE%E9%A2%98/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ctypes地址传递截断问题
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_5">
        
          
          <label class="md-nav__link" for="__nav_3_2_5" id="__nav_3_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    C++
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_5">
            <span class="md-nav__icon md-icon"></span>
            C++
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/C%2B%2B/%E7%BC%96%E8%AF%91ABI%E9%97%AE%E9%A2%98/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    编译ABI问题
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/C%2B%2B/%E6%A8%A1%E6%9D%BF%E5%85%83%E7%BC%96%E7%A8%8B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    模板元编程
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/C%2B%2B/%E5%A4%9AGCC%E7%8E%AF%E5%A2%83%E4%B8%8B%E8%AE%BE%E7%BD%AE%E7%BC%96%E8%AF%91%E5%99%A8%E7%89%88%E6%9C%AC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    多GCC环境下设置编译器版本
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/C%2B%2B/std%20sort%E5%B4%A9%E6%BA%83%E8%AE%B0%E5%BD%95/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Std sort崩溃记录
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/C%2B%2B/c%2B%2B%E7%BC%96%E8%AF%91%E4%B8%AD%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9A%84%E5%BC%95%E5%85%A5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    C++编译中第三方库的引入
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/C%2B%2B/c%2B%2B%E6%98%93%E9%94%99%E4%BB%A3%E7%A0%81%E6%9D%82%E8%AE%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    C++易错代码杂记
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/C%2B%2B/c%2B%2B%20macro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    C++ macro
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/C%2B%2B/Vector%E4%B8%8E%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E7%A4%BA%E4%BE%8B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vector与常用数据类型转换示例
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/C%2B%2B/RapidJSON/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RapidJSON
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/C%2B%2B/Handle%20abort%20signal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Handle abort signal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/C%2B%2B/FileIO%E7%A4%BA%E4%BE%8B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FileIO示例
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/C%2B%2B/C%2B%2B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    C++
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/C%2B%2B/C%2B%2B%2020%20corutine%20generator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    C++ 20 corutine generator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/C%2B%2B/C%2B%2B20%E4%B8%ADbarrier%E5%92%8Clatch%E6%9C%89%E4%BD%95%E4%B8%8D%E5%90%8C/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    C++20中barrier和latch有何不同
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_5_15">
        
          
          <label class="md-nav__link" for="__nav_3_2_5_15" id="__nav_3_2_5_15_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Abseil
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_2_5_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_5_15">
            <span class="md-nav__icon md-icon"></span>
            Abseil
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/C%2B%2B/Abseil/Status%E5%AE%9E%E7%8E%B0%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Status实现源码阅读
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/C%2B%2B/Abseil/FTADLE%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FTADLE设计模式
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%AF%87/C%2B%2B/Abseil/C%2B%2B%20Tips/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    C++ Tips
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3">
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    #开发技能篇
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            #开发技能篇
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_1">
        
          
          <label class="md-nav__link" for="__nav_3_3_1" id="__nav_3_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    工程实践
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_1">
            <span class="md-nav__icon md-icon"></span>
            工程实践
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E6%8A%80%E8%83%BD%E7%AF%87/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/Opencv%E6%8A%80%E5%B7%A7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Opencv技巧
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E6%8A%80%E8%83%BD%E7%AF%87/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/FFmpeg%E6%8A%80%E5%B7%A7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FFmpeg技巧
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E6%8A%80%E8%83%BD%E7%AF%87/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/Docker%E6%8A%80%E5%B7%A7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker技巧
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E6%8A%80%E8%83%BD%E7%AF%87/%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%E5%99%A8%E7%9A%84%E5%89%8D%E8%BF%9B-%E5%9B%9E%E9%80%80%E6%8C%89%E9%92%AE%E9%80%BB%E8%BE%91/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    如何实现文件管理器的前进/回退按钮逻辑
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E6%8A%80%E8%83%BD%E7%AF%87/%E5%8F%8C%E6%8B%BC%E4%BD%A0%E7%94%A8%E8%BF%87%E5%90%97/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    双拼你用过吗
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_4">
        
          
          <label class="md-nav__link" for="__nav_3_3_4" id="__nav_3_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    博客搭建记录
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_4">
            <span class="md-nav__icon md-icon"></span>
            博客搭建记录
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E6%8A%80%E8%83%BD%E7%AF%87/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E8%AE%B0%E5%BD%95/how%20to%20deploy%20a%20mkdocks%20blog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How to deploy a mkdocks blog
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E6%8A%80%E8%83%BD%E7%AF%87/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E8%AE%B0%E5%BD%95/hexo%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E8%AE%B0%E5%BD%95/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    hexo博客搭建记录
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E6%8A%80%E8%83%BD%E7%AF%87/%E4%BB%98%E8%B4%B9%E8%8E%B7%E5%8F%96%E5%AF%86%E7%A0%81%E5%B9%B3%E5%8F%B0%E5%8E%9F%E7%90%86/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    付费获取密码平台原理
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E6%8A%80%E8%83%BD%E7%AF%87/windows%E4%B8%8B%E6%89%93%E5%8C%85exe%E6%96%87%E4%BB%B6%E6%8A%80%E6%B3%95/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Windows下打包exe文件技法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E6%8A%80%E8%83%BD%E7%AF%87/blogs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blogs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E6%8A%80%E8%83%BD%E7%AF%87/QGIS%20%E4%BD%BF%E7%94%A8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Convert pyQt UI to python
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_9">
        
          
          <label class="md-nav__link" for="__nav_3_3_9" id="__nav_3_3_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Algorithm
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_9">
            <span class="md-nav__icon md-icon"></span>
            Algorithm
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E6%8A%80%E8%83%BD%E7%AF%87/Algorithm/%E6%97%A0%E9%94%81%E9%98%9F%E5%88%97%E5%AE%9E%E7%8E%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    无锁队列实现
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E6%8A%80%E8%83%BD%E7%AF%87/Algorithm/%E5%8D%95%E8%B0%83%E9%98%9F%E5%88%97/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    单调队列
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E6%8A%80%E8%83%BD%E7%AF%87/Algorithm/%E5%89%8D%E7%BC%80%E6%A0%91/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    前缀树
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E6%8A%80%E8%83%BD%E7%AF%87/Algorithm/LRU/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LRU
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E6%8A%80%E8%83%BD%E7%AF%87/Algorithm/ExamRoom/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ExamRoom
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4">
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    #开发工具篇
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            #开发工具篇
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E7%AF%87/%E9%AB%98%E6%95%88%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    高效使用工具
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_2">
        
          
          <label class="md-nav__link" for="__nav_3_4_2" id="__nav_3_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    编辑器之神
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_2">
            <span class="md-nav__icon md-icon"></span>
            编辑器之神
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E7%AF%87/%E7%BC%96%E8%BE%91%E5%99%A8%E4%B9%8B%E7%A5%9E/%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95vimscript%E7%A8%8B%E5%BA%8F/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    如何调试vimscript程序
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E7%AF%87/%E7%BC%96%E8%BE%91%E5%99%A8%E4%B9%8B%E7%A5%9E/%E5%A6%82%E4%BD%95%E6%9B%B4%E6%96%B0neovim%E4%BB%A5%E5%8F%8A%E5%AE%89%E8%A3%85%E6%8C%87%E5%AE%9A%E7%89%88%E6%9C%AC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    如何更新neovim以及安装指定版本.md
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E7%AF%87/%E7%BC%96%E8%BE%91%E5%99%A8%E4%B9%8B%E7%A5%9E/Vim%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vim奇淫技巧
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E7%AF%87/%E7%BC%96%E8%BE%91%E5%99%A8%E4%B9%8B%E7%A5%9E/AWK/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWK
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_3">
        
          
          <label class="md-nav__link" for="__nav_3_4_3" id="__nav_3_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    编译大法
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_3">
            <span class="md-nav__icon md-icon"></span>
            编译大法
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E7%AF%87/%E7%BC%96%E8%AF%91%E5%A4%A7%E6%B3%95/%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    交叉编译
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E7%AF%87/%E7%94%BB%E5%9B%BE%E5%B7%A5%E5%85%B7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    画图工具
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E7%AF%87/markdown/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Markdown
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_6">
        
          
          <label class="md-nav__link" for="__nav_3_4_6" id="__nav_3_4_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Linux提效
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_6">
            <span class="md-nav__icon md-icon"></span>
            Linux提效
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E7%AF%87/linux%E6%8F%90%E6%95%88/%E8%87%AA%E5%AE%9A%E4%B9%89Linux%E5%8F%91%E8%A1%8C%E5%8C%85/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    自定义Linux发行包
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E7%AF%87/linux%E6%8F%90%E6%95%88/%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8U%E7%9B%98%E5%88%B6%E4%BD%9C/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    系统启动U盘制作
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E7%AF%87/linux%E6%8F%90%E6%95%88/%E7%A3%81%E7%9B%98%E6%B8%85%E7%90%86%E5%B7%A5%E5%85%B7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    磁盘清理工具
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E7%AF%87/linux%E6%8F%90%E6%95%88/%E5%86%85%E5%AD%98%E6%A3%80%E6%B5%8B%E5%8F%8A%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    内存检测及调试工具
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E7%AF%87/linux%E6%8F%90%E6%95%88/%E4%BB%A5%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1%E6%96%B9%E5%BC%8F%E5%90%AF%E5%8A%A8%E7%A8%8B%E5%BA%8F/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    以系统服务方式启动程序
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E7%AF%87/linux%E6%8F%90%E6%95%88/systemd%20use%20service/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Systemd use service
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E7%AF%87/linux%E6%8F%90%E6%95%88/right%20Network%20way/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    right Network way
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E7%AF%87/linux%E6%8F%90%E6%95%88/linux%E9%9B%B6%E6%8B%B7%E8%B4%9D%E6%8A%80%E6%9C%AF/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linux零拷贝技术
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E7%AF%87/linux%E6%8F%90%E6%95%88/dotfiles%20config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dotfiles config
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E7%AF%87/linux%E6%8F%90%E6%95%88/Utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E7%AF%87/linux%E6%8F%90%E6%95%88/Linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linux常用命令行工具
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E7%AF%87/linux%E6%8F%90%E6%95%88/Linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linux常用命令
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_7">
        
          
          <label class="md-nav__link" for="__nav_3_4_7" id="__nav_3_4_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Vscode
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_7">
            <span class="md-nav__icon md-icon"></span>
            Vscode
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E7%AF%87/Vscode/Vscode%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vscode环境配置
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E7%AF%87/Linux%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linux开发环境配置
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E7%AF%87/Git/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Git
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E7%AF%87/Bash/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bash
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5">
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    #AI篇
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            #AI篇
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5_1">
        
          
          <label class="md-nav__link" for="__nav_3_5_1" id="__nav_3_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    mlir学习之旅
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5_1">
            <span class="md-nav__icon md-icon"></span>
            mlir学习之旅
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23AI%E7%AF%87/mlir/debug_toy_config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Debug toy config
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23AI%E7%AF%87/mlir/learn_toy4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Learn toy4
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23AI%E7%AF%87/mlir/learn_toy3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MLIR 系列–Toy3 Rewrite Pass
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23AI%E7%AF%87/mlir/learn_toy2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MLIR初遇–Toy2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23AI%E7%AF%87/mlir/%E5%85%B3%E4%BA%8Emlir%E7%9A%84%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    关于mlir的学习资料
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5_2">
        
          
          <label class="md-nav__link" for="__nav_3_5_2" id="__nav_3_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    llama多少也得会点
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5_2">
            <span class="md-nav__icon md-icon"></span>
            llama多少也得会点
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23AI%E7%AF%87/llama/gguf%E4%BD%BF%E7%94%A8mmap%E8%BF%9B%E8%A1%8C%E9%AB%98%E6%95%88%E8%AF%BB%E5%8F%96%E5%92%8C%E4%BF%9D%E5%AD%98/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Gguf使用mmap进行高效读取和保存
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5_3">
        
          
          <label class="md-nav__link" for="__nav_3_5_3" id="__nav_3_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    lmdepoly如何实现的？
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5_3">
            <span class="md-nav__icon md-icon"></span>
            lmdepoly如何实现的？
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23AI%E7%AF%87/lmdeploy/%E9%80%9A%E8%BF%87lmdepoly%E5%AD%A6%E4%B9%A0Python%E4%B8%AD%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E6%B3%A8%E5%86%8C%E6%A8%A1%E5%BC%8F/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    通过lmdepoly学习Python中如何实现注册模式
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23AI%E7%AF%87/lmdeploy/Intervl2-8B%E6%A8%A1%E5%9E%8B%E7%9A%84%E9%A2%84%E5%A4%84%E7%90%86preprocess%E6%9C%89%E4%BD%95%E4%B8%8D%E5%90%8C%3F/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Intervl2 8B模型的预处理preprocess有何不同?
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5_4">
        
          
          <label class="md-nav__link" for="__nav_3_5_4" id="__nav_3_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    triton_server是个啥？
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5_4">
            <span class="md-nav__icon md-icon"></span>
            triton_server是个啥？
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23AI%E7%AF%87/triton_server/tritonServer%E4%B8%AD%E7%9A%84decouple%E6%A8%A1%E5%BC%8F%E6%98%AF%E4%BB%80%E4%B9%88%3F/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Triton推理服务器中的解耦模式
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/%23AI%E7%AF%87/triton_server/TritonServer%E7%9A%84pythonbackend%E6%9D%82%E8%AE%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TritonServer的pythonbackend杂记
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    关于我
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#如何编写一个llvm-pass" class="md-nav__link">
    <span class="md-ellipsis">
      如何编写一个LLVM Pass
    </span>
  </a>
  
    <nav class="md-nav" aria-label="如何编写一个LLVM Pass">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#llvm介绍" class="md-nav__link">
    <span class="md-ellipsis">
      LLVM介绍
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#什么是编译器呢" class="md-nav__link">
    <span class="md-ellipsis">
      什么是编译器呢？
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llvm-pass" class="md-nav__link">
    <span class="md-ellipsis">
      LLVM Pass
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#如何编写一个llvm-pass_1" class="md-nav__link">
    <span class="md-ellipsis">
      如何编写一个LLVM Pass
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#参考" class="md-nav__link">
    <span class="md-ellipsis">
      参考
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#llvm开发中的一些概念" class="md-nav__link">
    <span class="md-ellipsis">
      LLVM开发中的一些概念
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LLVM开发中的一些概念">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#module是什么" class="md-nav__link">
    <span class="md-ellipsis">
      Module是什么？
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-block是什么" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Block是什么？
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#control-flow-graph-是什么" class="md-nav__link">
    <span class="md-ellipsis">
      Control Flow Graph 是什么？
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#通过例子学习如何编写pass" class="md-nav__link">
    <span class="md-ellipsis">
      通过例子学习如何编写Pass
    </span>
  </a>
  
    <nav class="md-nav" aria-label="通过例子学习如何编写Pass">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pass-example1-打印全局变量及其类型" class="md-nav__link">
    <span class="md-ellipsis">
      Pass example1: 打印全局变量及其类型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pass-example2-检测没有使用过的全局变量" class="md-nav__link">
    <span class="md-ellipsis">
      Pass example2: 检测没有使用过的全局变量
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pass-example3-打印函数内所有基本块" class="md-nav__link">
    <span class="md-ellipsis">
      Pass example3: 打印函数内所有基本块
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pass-example4-检测递归" class="md-nav__link">
    <span class="md-ellipsis">
      Pass example4: 检测递归
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pass-example5-对控制流图进行深度优先搜索dfs" class="md-nav__link">
    <span class="md-ellipsis">
      Pass example5: 对控制流图进行深度优先搜索（DFS）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#llvm-jit介绍" class="md-nav__link">
    <span class="md-ellipsis">
      LLVM JIT介绍
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LLVM JIT介绍">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#什么是jit" class="md-nav__link">
    <span class="md-ellipsis">
      什么是JIT？
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#什么是orc" class="md-nav__link">
    <span class="md-ellipsis">
      什么是ORC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llvm中的jit" class="md-nav__link">
    <span class="md-ellipsis">
      LLVM中的JIT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#使用llvm-jit的基本步骤" class="md-nav__link">
    <span class="md-ellipsis">
      使用LLVM JIT的基本步骤
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#实现一个计算器" class="md-nav__link">
    <span class="md-ellipsis">
      实现一个计算器
    </span>
  </a>
  
    <nav class="md-nav" aria-label="实现一个计算器">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#代码实现" class="md-nav__link">
    <span class="md-ellipsis">
      代码实现
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#参考_1" class="md-nav__link">
    <span class="md-ellipsis">
      参考
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../" class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
                  <span class="md-ellipsis">
                    回到主页
                  </span>
                </a>
              </div>
            </div>
            
              <div class="md-post__authors md-typeset">
                
                  <div class="md-profile md-post__profile">
                    <span class="md-author md-author--long">
                      <img src="https://raw.githubusercontent.com/KenForever1/CDN/main/logo.png" alt="KenForever1">
                    </span>
                    <span class="md-profile__description">
                      <strong>
                        
                          KenForever1
                        
                      </strong>
                      <br>
                      Creator
                    </span>
                  </div>
                
              </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    元数据
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5z"></path></svg>
                        <time datetime="2025-03-09 00:00:00+00:00" class="md-ellipsis">2025年3月9日</time>
                      </div>
                    </li>
                    
                    
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3v15h3V3zm3 2 4 13 3-1-4-13zM5 5v13h3V5zM3 19v2h18v-2z"></path></svg>
                          <span class="md-ellipsis">
                            分类于
                            
                              <a href="../category/llvm/">llvm</a></span>
                        </div>
                      </li>
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7z"></path></svg>
                          <span class="md-ellipsis">
                            
                              需要 14 分钟阅读时间
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
            
          </nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        
  



  
    <a href="https://github.com/KenForever1/edit/main/docs/blog/posts/LLVM入门-实现一个计算器.md" title="编辑此页" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"></path></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/KenForever1/raw/main/docs/blog/posts/LLVM入门-实现一个计算器.md" title="查看本页的源代码" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"></path></svg>
    </a>
  


  <h1>LLVM入门-实现一个计算器</h1>

<h2 id="如何编写一个llvm-pass">如何编写一个LLVM Pass<a class="headerlink" href="#如何编写一个llvm-pass" title="Permanent link">¶</a></h2>
<h3 id="llvm介绍">LLVM介绍<a class="headerlink" href="#llvm介绍" title="Permanent link">¶</a></h3>
<p>LLVM，全称为低级虚拟机（Low-Level Virtual Machine），是一组模块化和可重用的编译器及工具链技术。由于其灵活的架构，LLVM在多个领域具有广泛的应用。它能够生成机器本地代码，因此被用作主要编程语言（如Rust和Swift）的后端。此外，LLVM还被用于即时编译（JIT编译）以及静态分析、动态分析、着色器编译等多种任务。</p>
<!-- more -->
<p>LLVM的设计目标是提供一个中间表示（IR），以便优化和生成高效的机器代码。它的模块化设计允许开发者根据需要增加或替换组件，从而实现特定的功能或优化。这使得LLVM在学术界和工业界都得到了广泛的应用和支持。</p>
<p>通过不断的发展和演化，LLVM已经成为编译器技术领域的重要组成部分，推动了现代编程语言的发展和性能提升。</p>
<h3 id="什么是编译器呢">什么是编译器呢？<a class="headerlink" href="#什么是编译器呢" title="Permanent link">¶</a></h3>
<p>编译器是一种软件程序，用于将用高级编程语言编写的源代码翻译成计算机处理器可以执行的形式。一般来说，编译器由三个部分组成：</p>
<ol>
<li>
<p>前端：编译器的前端负责分析源代码，并将其转换为一种中间表示（IR）。这种中间表示通常独立于源编程语言和目标架构，使得可以进行多种优化，并提高代码的可移植性。</p>
</li>
<li>
<p>中端：编译器的中端对中间表示进行与目标CPU架构无关的优化。这个阶段的重点是进行通用优化，以提高程序的性能和效率。</p>
</li>
<li>
<p>后端：编译器的后端将优化后的中间表示转换为特定于目标架构的机器代码或汇编代码。后端还负责应用与目标硬件相关的优化，以确保生成的代码能高效地在指定硬件上运行。</p>
</li>
</ol>
<p>通过这三个阶段，编译器能够将人类可读的源代码转化为计算机可以执行的高效机器代码。</p>
<h3 id="llvm-pass">LLVM Pass<a class="headerlink" href="#llvm-pass" title="Permanent link">¶</a></h3>
<p>在LLVM中，Pass是一种模块化和可重用的组件，旨在对程序的中间表示（IR）进行转换或分析。</p>
<p>根据LLVM的官方文档，Pass主要分为两大类：分析Pass（Analysis Passes）和转换Pass（Transform Passes）。此外，还有一种被称为实用工具Pass（Utility Passes）的类别。</p>
<ol>
<li>
<p>分析Pass（Analysis Passes）：这类Pass用于收集信息和分析代码，而不对代码进行任何修改。它们帮助编译器获取有关程序结构和行为的数据，以便进行进一步的优化和转换。</p>
</li>
<li>
<p>转换Pass（Transform Passes）：这类Pass用于修改程序的IR，以提高性能、减少代码体积或为进一步的优化做好准备。转换Pass直接对代码进行更改，以实现更高效的执行。</p>
</li>
</ol>
<p>通过这些Pass，LLVM能够实现复杂的代码分析和优化，从而生成高效的机器代码。</p>
<h3 id="如何编写一个llvm-pass_1">如何编写一个LLVM Pass<a class="headerlink" href="#如何编写一个llvm-pass_1" title="Permanent link">¶</a></h3>
<p>编写LLVM Pass首先需要准备环境，安装上llvm、clang、cmake。安装方法：</p>
<div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>wget<span class="w"> </span>https://apt.llvm.org/llvm.sh
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>chmod<span class="w"> </span>+x<span class="w"> </span>llvm.sh
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>./llvm.sh<span class="w"> </span><span class="m">16</span>
</code></pre></div></td></tr></tbody></table></div>
<p>运行命令会安装llvm-16, clang-16, clang++-16以及相关的工具。头文件安装在：/usr/include/llvm-16/llvm。</p>
<p>LLVM包含两种Pass管理器：旧版Pass管理器（legacy PM）和新版Pass管理器（new PM）。在中端阶段，LLVM使用新版Pass管理器，而在与目标架构相关的后端代码生成阶段，则使用旧版Pass管理器。我们在编写自己的Pass时，可以选择使用旧版或新版管理器。在本文中，我们将使用新版Pass管理器。</p>
<p>新版Pass管理器相较于旧版，通常提供了更好的性能和灵活性，适合用于需要现代优化技术的场合。通过利用新版Pass管理器，我们可以更有效地进行代码分析和优化。</p>
<p>通过下面的例子编译一个简单的Pass，实现将函数名打印出来。</p>
<div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span>
<span class="normal"><a href="#__codelineno-1-21">21</a></span>
<span class="normal"><a href="#__codelineno-1-22">22</a></span>
<span class="normal"><a href="#__codelineno-1-23">23</a></span>
<span class="normal"><a href="#__codelineno-1-24">24</a></span>
<span class="normal"><a href="#__codelineno-1-25">25</a></span>
<span class="normal"><a href="#__codelineno-1-26">26</a></span>
<span class="normal"><a href="#__codelineno-1-27">27</a></span>
<span class="normal"><a href="#__codelineno-1-28">28</a></span>
<span class="normal"><a href="#__codelineno-1-29">29</a></span>
<span class="normal"><a href="#__codelineno-1-30">30</a></span>
<span class="normal"><a href="#__codelineno-1-31">31</a></span>
<span class="normal"><a href="#__codelineno-1-32">32</a></span>
<span class="normal"><a href="#__codelineno-1-33">33</a></span>
<span class="normal"><a href="#__codelineno-1-34">34</a></span>
<span class="normal"><a href="#__codelineno-1-35">35</a></span>
<span class="normal"><a href="#__codelineno-1-36">36</a></span>
<span class="normal"><a href="#__codelineno-1-37">37</a></span>
<span class="normal"><a href="#__codelineno-1-38">38</a></span>
<span class="normal"><a href="#__codelineno-1-39">39</a></span>
<span class="normal"><a href="#__codelineno-1-40">40</a></span>
<span class="normal"><a href="#__codelineno-1-41">41</a></span>
<span class="normal"><a href="#__codelineno-1-42">42</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">"llvm/IR/PassManager.h"</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">"llvm/Passes/PassBuilder.h"</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">"llvm/Passes/PassPlugin.h"</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">"llvm/Support/raw_ostream.h"</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">llvm</span><span class="p">;</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="k">namespace</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="p">{</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="w">  </span><span class="c1">// 在LLVM中，所有的Pass都必须继承自CRTP（Curiously Recurring Template Pattern）混入类PassInfoMixin。这种设计模式允许Pass通过模板机制来获得与Pass相关的元信息。</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">FunctionListerPass</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">PassInfoMixin</span><span class="o">&lt;</span><span class="n">FunctionListerPass</span><span class="o">&gt;</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="w">    </span><span class="c1">// A pass should have a run method</span>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="w">    </span><span class="n">PreservedAnalyses</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="n">Function</span><span class="w"> </span><span class="o">&amp;</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">FunctionAnalysisManager</span><span class="w"> </span><span class="o">&amp;</span><span class="n">FAM</span><span class="p">)</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="w">      </span><span class="c1">// outs() returns a reference to a raw_fd_ostream for standard output.</span>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="w">      </span><span class="n">outs</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">F</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">PreservedAnalyses</span><span class="o">::</span><span class="n">all</span><span class="p">();</span>
<a id="__codelineno-1-18" name="__codelineno-1-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-19" name="__codelineno-1-19"></a><span class="w">  </span><span class="p">};</span>
<a id="__codelineno-1-20" name="__codelineno-1-20"></a>
<a id="__codelineno-1-21" name="__codelineno-1-21"></a><span class="p">}</span>
<a id="__codelineno-1-22" name="__codelineno-1-22"></a>
<a id="__codelineno-1-23" name="__codelineno-1-23"></a><span class="n">PassPluginLibraryInfo</span><span class="w"> </span><span class="n">getPassPluginInfo</span><span class="p">()</span>
<a id="__codelineno-1-24" name="__codelineno-1-24"></a><span class="p">{</span>
<a id="__codelineno-1-25" name="__codelineno-1-25"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">callback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[](</span><span class="n">PassBuilder</span><span class="w"> </span><span class="o">&amp;</span><span class="n">PB</span><span class="p">)</span>
<a id="__codelineno-1-26" name="__codelineno-1-26"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-1-27" name="__codelineno-1-27"></a><span class="w">    </span><span class="n">PB</span><span class="p">.</span><span class="n">registerPipelineStartEPCallback</span><span class="p">(</span>
<a id="__codelineno-1-28" name="__codelineno-1-28"></a><span class="w">        </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="n">ModulePassManager</span><span class="w"> </span><span class="o">&amp;</span><span class="n">MPM</span><span class="p">,</span><span class="w"> </span><span class="k">auto</span><span class="p">)</span>
<a id="__codelineno-1-29" name="__codelineno-1-29"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-1-30" name="__codelineno-1-30"></a><span class="w">          </span><span class="n">MPM</span><span class="p">.</span><span class="n">addPass</span><span class="p">(</span><span class="n">createModuleToFunctionPassAdaptor</span><span class="p">(</span><span class="n">FunctionListerPass</span><span class="p">()));</span>
<a id="__codelineno-1-31" name="__codelineno-1-31"></a><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-1-32" name="__codelineno-1-32"></a><span class="w">        </span><span class="p">});</span>
<a id="__codelineno-1-33" name="__codelineno-1-33"></a><span class="w">  </span><span class="p">};</span>
<a id="__codelineno-1-34" name="__codelineno-1-34"></a>
<a id="__codelineno-1-35" name="__codelineno-1-35"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="n">LLVM_PLUGIN_API_VERSION</span><span class="p">,</span><span class="w"> </span><span class="s">"name"</span><span class="p">,</span><span class="w"> </span><span class="s">"0.0.1"</span><span class="p">,</span><span class="w"> </span><span class="n">callback</span><span class="p">};</span>
<a id="__codelineno-1-36" name="__codelineno-1-36"></a><span class="p">};</span>
<a id="__codelineno-1-37" name="__codelineno-1-37"></a>
<a id="__codelineno-1-38" name="__codelineno-1-38"></a><span class="c1">// 当驱动程序加载一个插件时，它会调用这个入口点以获取有关该插件的信息，以及如何注册其Pass的信息。</span>
<a id="__codelineno-1-39" name="__codelineno-1-39"></a><span class="k">extern</span><span class="w"> </span><span class="s">"C"</span><span class="w"> </span><span class="n">LLVM_ATTRIBUTE_WEAK</span><span class="w"> </span><span class="n">PassPluginLibraryInfo</span><span class="w"> </span><span class="n">llvmGetPassPluginInfo</span><span class="p">()</span>
<a id="__codelineno-1-40" name="__codelineno-1-40"></a><span class="p">{</span>
<a id="__codelineno-1-41" name="__codelineno-1-41"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">getPassPluginInfo</span><span class="p">();</span>
<a id="__codelineno-1-42" name="__codelineno-1-42"></a><span class="p">}</span>
</code></pre></div></td></tr></tbody></table></div>
<p>将上面的Pass代码编译为一个动态链接库func_lister.so。</p>
<div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a>clang-16<span class="w"> </span>-shared<span class="w"> </span>-o<span class="w"> </span>func_lister.so<span class="w"> </span>func_lister.cpp<span class="w"> </span>-fPIC<span class="w"> </span>-I<span class="w"> </span>/usr/inc
<a id="__codelineno-2-2" name="__codelineno-2-2"></a>lude/llvm-c-16/<span class="w"> </span>-I<span class="w"> </span>/usr/include/llvm-16/
</code></pre></div></td></tr></tbody></table></div>
<p>然后，为了验证我们开发的pass，需要写一个例子test.c。
</p><div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="c1">// test.c</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="kt">void</span><span class="w"> </span><span class="nf">testFunctionOne</span><span class="p">()</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="p">{</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="p">}</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="kt">void</span><span class="w"> </span><span class="nf">testFunctionTwo</span><span class="p">()</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="p">{</span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="p">}</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="p">{</span>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="p">}</span>
</code></pre></div></td></tr></tbody></table></div><p></p>
<p>编译的时候要制定-O1或者-O2、-O3优化级别，否则不会执行我们的Pass。指定优化级别（例如，用-O1）是重要的，因为它决定了LLVM编译器在编译过程中会应用哪些优化阶段和passes。你会发现不指定优化级别时(默认-O0)，我们的Pass不会被执行。
</p><div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a>clang-16<span class="w"> </span>-O1<span class="w"> </span>-fpass-plugin<span class="o">=</span>./func_lister.so<span class="w"> </span>test.c<span class="w"> </span>-o<span class="w"> </span><span class="nb">test</span>
</code></pre></div></td></tr></tbody></table></div>
clang-16程序会输出test.c定义的函数名：
<div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span>
<span class="normal"><a href="#__codelineno-5-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a>testFunctionOne
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>testFunctionTwo
<a id="__codelineno-5-3" name="__codelineno-5-3"></a>main
</code></pre></div></td></tr></tbody></table></div><p></p>
<h3 id="参考">参考<a class="headerlink" href="#参考" title="Permanent link">¶</a></h3>
<ul>
<li>
<p>https://llvm.org/docs/WritingAnLLVMNewPMPass.html</p>
</li>
<li>
<p>https://blog.llvm.org/posts/2021-03-26-the-new-pass-manager/</p>
</li>
<li>
<p>https://stackoverflow.com/questions/54447985/how-to-automatically-register-and-load-modern-pass-in-clang</p>
</li>
<li>
<p>https://sh4dy.com/2024/06/29/learning_llvm_01/</p>
</li>
</ul>
<h2 id="llvm开发中的一些概念">LLVM开发中的一些概念<a class="headerlink" href="#llvm开发中的一些概念" title="Permanent link">¶</a></h2>
<h3 id="module是什么">Module是什么？<a class="headerlink" href="#module是什么" title="Permanent link">¶</a></h3>
<p>在LLVM中，Module是一个顶层容器，用于封装与整个程序或程序的重要部分相关的所有信息。它是LLVM中间表示（IR）对象的最高级别的容器。每个Module包含以下内容：<strong>全局变量列表</strong>、 <strong>函数列表</strong>、<strong>依赖的库或其他模块的列表</strong>、<strong>符号表</strong>、<strong>目标特性元数据</strong>。</p>
<p>Module在LLVM中扮演着一个关键角色，作为所有相关信息的集成点，用于表示和操作整个程序的结构和行为。它为LLVM的编译和优化过程提供了必要的上下文和组织结构。</p>
<h3 id="basic-block是什么">Basic Block是什么？<a class="headerlink" href="#basic-block是什么" title="Permanent link">¶</a></h3>
<p>基本块（Basic Block）是指一组直线执行的指令序列，其中没有分支。这意味着执行从一个单一的入口点开始，按顺序执行到一个单一的出口点，然后继续到下一个基本块。基本块属于某个函数，并且不能在其中间插入跳转，这确保了一旦开始执行，控制流将会顺序执行完该块中的所有指令。</p>
<p>基本块的特点包括：</p>
<ol>
<li>
<p><strong>单一入口和出口</strong>：每个基本块只有一个入口点和一个出口点，没有中途跳转，这保证了指令的线性执行。</p>
</li>
<li>
<p><strong>连贯性</strong>：一旦程序执行进入基本块，它将按顺序执行该块中的所有指令，直到到达出口点。</p>
</li>
<li>
<p><strong>函数的组成部分</strong>：基本块是函数中的基本构建单位，函数由一个或多个基本块组成。</p>
</li>
<li>
<p><strong>领导者指令</strong>：基本块的第一条指令通常被称为“领导者”（leader），因为它是控制流进入该基本块时首先执行的指令。</p>
</li>
</ol>
<p>基本块的结构有助于简化控制流分析和优化，因为它们提供了清晰的执行路径，便于编译器进行优化处理，如常量合并、指令重新排序等。</p>
<h3 id="control-flow-graph-是什么">Control Flow Graph 是什么？<a class="headerlink" href="#control-flow-graph-是什么" title="Permanent link">¶</a></h3>
<p>控制流图（Control Flow Graph，CFG）是一个有向图，其中的节点代表基本块，节点之间的边表示控制流路径，指示执行如何从一个基本块转移到另一个基本块。</p>
<p>控制流图的特点和作用包括：<strong>节点表示基本块</strong>：在CFG中，每个节点对应一个基本块，基本块是程序中一段没有中断的指令序列。<strong>边表示控制流</strong>：节点之间的有向边表示程序在执行时可能的转移路径。也就是说，如果程序在一个基本块结束后可能转移到另一个基本块，那么在CFG中，这两个基本块之间就会有一条边。</p>
<p>CFG是编译器进行程序分析和优化的重要工具。通过分析CFG，编译器可以了解程序的执行流程，从而进行优化，例如死代码消除、循环优化、路径分析等。</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="https://sh4dy.com/images/llvm_learning/llvm_learning_02.png" data-desc-position="bottom"><img alt="" src="https://sh4dy.com/images/llvm_learning/llvm_learning_02.png"></a></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="https://eli.thegreenplace.net/images/2013/09/diamond-cfg.png" data-desc-position="bottom"><img alt="" src="https://eli.thegreenplace.net/images/2013/09/diamond-cfg.png"></a></p>
<h2 id="通过例子学习如何编写pass">通过例子学习如何编写Pass<a class="headerlink" href="#通过例子学习如何编写pass" title="Permanent link">¶</a></h2>
<p>前面的Pass注册使用了registerPipelineStartEPCallback，这个小节的例子换成registerPipelineParsingCallback。</p>
<div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span>
<span class="normal"><a href="#__codelineno-6-18">18</a></span>
<span class="normal"><a href="#__codelineno-6-19">19</a></span>
<span class="normal"><a href="#__codelineno-6-20">20</a></span>
<span class="normal"><a href="#__codelineno-6-21">21</a></span>
<span class="normal"><a href="#__codelineno-6-22">22</a></span>
<span class="normal"><a href="#__codelineno-6-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="n">PassPluginLibraryInfo</span><span class="w"> </span><span class="nf">getPassPluginInfo</span><span class="p">()</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="p">{</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">callback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[](</span><span class="n">PassBuilder</span><span class="w"> </span><span class="o">&amp;</span><span class="n">PB</span><span class="p">)</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="w">        </span><span class="n">PB</span><span class="p">.</span><span class="n">registerPipelineParsingCallback</span><span class="p">(</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="w">            </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="n">StringRef</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">ModulePassManager</span><span class="w"> </span><span class="o">&amp;</span><span class="n">MPM</span><span class="p">,</span><span class="w"> </span><span class="n">ArrayRef</span><span class="o">&lt;</span><span class="n">PassBuilder</span><span class="o">::</span><span class="n">PipelineElement</span><span class="o">&gt;</span><span class="p">)</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="w">            </span><span class="p">{</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"run-pass"</span><span class="p">)</span>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="w">                </span><span class="p">{</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="w">                    </span><span class="n">MPM</span><span class="p">.</span><span class="n">addPass</span><span class="p">(</span><span class="n">SomePass</span><span class="p">());</span>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="w">            </span><span class="p">});</span>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a>
<a id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="n">LLVM_PLUGIN_API_VERSION</span><span class="p">,</span><span class="w"> </span><span class="s">"SomePass"</span><span class="p">,</span><span class="w"> </span><span class="n">LLVM_VERSION_STRING</span><span class="p">,</span><span class="w"> </span><span class="n">callback</span><span class="p">};</span>
<a id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="p">};</span>
<a id="__codelineno-6-19" name="__codelineno-6-19"></a>
<a id="__codelineno-6-20" name="__codelineno-6-20"></a><span class="k">extern</span><span class="w"> </span><span class="s">"C"</span><span class="w"> </span><span class="n">LLVM_ATTRIBUTE_WEAK</span><span class="w"> </span><span class="n">PassPluginLibraryInfo</span><span class="w"> </span><span class="n">llvmGetPassPluginInfo</span><span class="p">()</span>
<a id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="p">{</span>
<a id="__codelineno-6-22" name="__codelineno-6-22"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">getPassPluginInfo</span><span class="p">();</span>
<a id="__codelineno-6-23" name="__codelineno-6-23"></a><span class="p">}</span>
</code></pre></div></td></tr></tbody></table></div>
<p>可以通过下面的命令，生成包含LLVM IR的.ll 文件，然后使用opt工具执行我们的Pass。</p>
<div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span>
<span class="normal"><a href="#__codelineno-7-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a>clang-16<span class="w"> </span>-S<span class="w"> </span>-emit-llvm<span class="w"> </span>test.c<span class="w"> </span>-o<span class="w"> </span>test.ll
<a id="__codelineno-7-2" name="__codelineno-7-2"></a>opt-16<span class="w"> </span>-load-pass-plugin<span class="w"> </span>./lib.so<span class="w"> </span>-passes<span class="o">=</span>run-pass<span class="w"> </span>-disable-output<span class="w"> </span>test.ll
</code></pre></div></td></tr></tbody></table></div>
<div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span>
<span class="normal"><a href="#__codelineno-8-3">3</a></span>
<span class="normal"><a href="#__codelineno-8-4">4</a></span>
<span class="normal"><a href="#__codelineno-8-5">5</a></span>
<span class="normal"><a href="#__codelineno-8-6">6</a></span>
<span class="normal"><a href="#__codelineno-8-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">SomePass</span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">PassInfoMixin</span><span class="o">&lt;</span><span class="n">SomePass</span><span class="o">&gt;</span><span class="p">{</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="w">  </span><span class="p">...</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">isRequired</span><span class="p">()</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="p">}</span>
</code></pre></div></td></tr></tbody></table></div>
<p>完整可编译代码访问<a href="https://github.com/KenForever1/llvm_snippet">KenForever1/llvm_snippet</a></p>
<h3 id="pass-example1-打印全局变量及其类型">Pass example1: 打印全局变量及其类型<a class="headerlink" href="#pass-example1-打印全局变量及其类型" title="Permanent link">¶</a></h3>
<p>这是一个简单的 LLVM 传递，它会打印出程序中的所有全局变量及其类型。代码遍历所有全局变量，获取它们的名称和类型，并将其打印出来。
</p><div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span>
<span class="normal"><a href="#__codelineno-9-11">11</a></span>
<span class="normal"><a href="#__codelineno-9-12">12</a></span>
<span class="normal"><a href="#__codelineno-9-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="n">PreservedAnalyses</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="n">Module</span><span class="w"> </span><span class="o">&amp;</span><span class="n">M</span><span class="p">,</span><span class="w"> </span><span class="n">ModuleAnalysisManager</span><span class="w"> </span><span class="o">&amp;</span><span class="n">MPM</span><span class="p">)</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="p">{</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">globals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M</span><span class="p">.</span><span class="n">globals</span><span class="p">();</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">itr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">globals</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span><span class="n">itr</span><span class="o">!=</span><span class="n">globals</span><span class="p">.</span><span class="n">end</span><span class="p">();</span><span class="n">itr</span><span class="o">++</span><span class="p">){</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="w">    </span><span class="n">StringRef</span><span class="w"> </span><span class="n">varName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itr</span><span class="o">-&gt;</span><span class="n">getName</span><span class="p">();</span>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="w">    </span><span class="n">Type</span><span class="o">*</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itr</span><span class="o">-&gt;</span><span class="n">getType</span><span class="p">();</span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="w">    </span><span class="n">outs</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="s">"Variable Name: "</span><span class="o">&lt;&lt;</span><span class="n">varName</span><span class="o">&lt;&lt;</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="w">    </span><span class="n">outs</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="s">"Variable Type: "</span><span class="p">;</span>
<a id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="w">    </span><span class="n">ty</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">(</span><span class="n">outs</span><span class="p">());</span>
<a id="__codelineno-9-10" name="__codelineno-9-10"></a><span class="w">    </span><span class="n">outs</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-9-11" name="__codelineno-9-11"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-9-12" name="__codelineno-9-12"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">PreservedAnalyses</span><span class="o">::</span><span class="n">all</span><span class="p">();</span>
<a id="__codelineno-9-13" name="__codelineno-9-13"></a><span class="p">}</span>
</code></pre></div></td></tr></tbody></table></div><p></p>
<p>完整代码：
</p><div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span>
<span class="normal"><a href="#__codelineno-10-11">11</a></span>
<span class="normal"><a href="#__codelineno-10-12">12</a></span>
<span class="normal"><a href="#__codelineno-10-13">13</a></span>
<span class="normal"><a href="#__codelineno-10-14">14</a></span>
<span class="normal"><a href="#__codelineno-10-15">15</a></span>
<span class="normal"><a href="#__codelineno-10-16">16</a></span>
<span class="normal"><a href="#__codelineno-10-17">17</a></span>
<span class="normal"><a href="#__codelineno-10-18">18</a></span>
<span class="normal"><a href="#__codelineno-10-19">19</a></span>
<span class="normal"><a href="#__codelineno-10-20">20</a></span>
<span class="normal"><a href="#__codelineno-10-21">21</a></span>
<span class="normal"><a href="#__codelineno-10-22">22</a></span>
<span class="normal"><a href="#__codelineno-10-23">23</a></span>
<span class="normal"><a href="#__codelineno-10-24">24</a></span>
<span class="normal"><a href="#__codelineno-10-25">25</a></span>
<span class="normal"><a href="#__codelineno-10-26">26</a></span>
<span class="normal"><a href="#__codelineno-10-27">27</a></span>
<span class="normal"><a href="#__codelineno-10-28">28</a></span>
<span class="normal"><a href="#__codelineno-10-29">29</a></span>
<span class="normal"><a href="#__codelineno-10-30">30</a></span>
<span class="normal"><a href="#__codelineno-10-31">31</a></span>
<span class="normal"><a href="#__codelineno-10-32">32</a></span>
<span class="normal"><a href="#__codelineno-10-33">33</a></span>
<span class="normal"><a href="#__codelineno-10-34">34</a></span>
<span class="normal"><a href="#__codelineno-10-35">35</a></span>
<span class="normal"><a href="#__codelineno-10-36">36</a></span>
<span class="normal"><a href="#__codelineno-10-37">37</a></span>
<span class="normal"><a href="#__codelineno-10-38">38</a></span>
<span class="normal"><a href="#__codelineno-10-39">39</a></span>
<span class="normal"><a href="#__codelineno-10-40">40</a></span>
<span class="normal"><a href="#__codelineno-10-41">41</a></span>
<span class="normal"><a href="#__codelineno-10-42">42</a></span>
<span class="normal"><a href="#__codelineno-10-43">43</a></span>
<span class="normal"><a href="#__codelineno-10-44">44</a></span>
<span class="normal"><a href="#__codelineno-10-45">45</a></span>
<span class="normal"><a href="#__codelineno-10-46">46</a></span>
<span class="normal"><a href="#__codelineno-10-47">47</a></span>
<span class="normal"><a href="#__codelineno-10-48">48</a></span>
<span class="normal"><a href="#__codelineno-10-49">49</a></span>
<span class="normal"><a href="#__codelineno-10-50">50</a></span>
<span class="normal"><a href="#__codelineno-10-51">51</a></span>
<span class="normal"><a href="#__codelineno-10-52">52</a></span>
<span class="normal"><a href="#__codelineno-10-53">53</a></span>
<span class="normal"><a href="#__codelineno-10-54">54</a></span>
<span class="normal"><a href="#__codelineno-10-55">55</a></span>
<span class="normal"><a href="#__codelineno-10-56">56</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="c1">// main.cpp</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">"llvm/IR/PassManager.h"</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">"llvm/Passes/PassBuilder.h"</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">"llvm/Passes/PassPlugin.h"</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">"llvm/Support/raw_ostream.h"</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">llvm</span><span class="p">;</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="k">namespace</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="p">{</span>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">GlobalVarsPass</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">PassInfoMixin</span><span class="o">&lt;</span><span class="n">GlobalVarsPass</span><span class="o">&gt;</span>
<a id="__codelineno-10-11" name="__codelineno-10-11"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-10-12" name="__codelineno-10-12"></a><span class="w">    </span><span class="n">PreservedAnalyses</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="n">Module</span><span class="w"> </span><span class="o">&amp;</span><span class="n">M</span><span class="p">,</span><span class="w"> </span><span class="n">ModuleAnalysisManager</span><span class="w"> </span><span class="o">&amp;</span><span class="n">MPM</span><span class="p">)</span>
<a id="__codelineno-10-13" name="__codelineno-10-13"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-10-14" name="__codelineno-10-14"></a><span class="w">      </span><span class="k">auto</span><span class="w"> </span><span class="n">globals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M</span><span class="p">.</span><span class="n">globals</span><span class="p">();</span>
<a id="__codelineno-10-15" name="__codelineno-10-15"></a><span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">itr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">globals</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span><span class="n">itr</span><span class="o">!=</span><span class="n">globals</span><span class="p">.</span><span class="n">end</span><span class="p">();</span><span class="n">itr</span><span class="o">++</span><span class="p">){</span>
<a id="__codelineno-10-16" name="__codelineno-10-16"></a><span class="w">        </span><span class="n">StringRef</span><span class="w"> </span><span class="n">varName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itr</span><span class="o">-&gt;</span><span class="n">getName</span><span class="p">();</span>
<a id="__codelineno-10-17" name="__codelineno-10-17"></a><span class="w">        </span><span class="n">Type</span><span class="o">*</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itr</span><span class="o">-&gt;</span><span class="n">getType</span><span class="p">();</span>
<a id="__codelineno-10-18" name="__codelineno-10-18"></a><span class="w">        </span><span class="n">outs</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="s">"Variable Name: "</span><span class="o">&lt;&lt;</span><span class="n">varName</span><span class="o">&lt;&lt;</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-10-19" name="__codelineno-10-19"></a><span class="w">        </span><span class="n">outs</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="s">"Variable Type: "</span><span class="p">;</span>
<a id="__codelineno-10-20" name="__codelineno-10-20"></a><span class="w">        </span><span class="n">ty</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">(</span><span class="n">outs</span><span class="p">());</span>
<a id="__codelineno-10-21" name="__codelineno-10-21"></a><span class="w">        </span><span class="n">outs</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-10-22" name="__codelineno-10-22"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-10-23" name="__codelineno-10-23"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">PreservedAnalyses</span><span class="o">::</span><span class="n">all</span><span class="p">();</span>
<a id="__codelineno-10-24" name="__codelineno-10-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-10-25" name="__codelineno-10-25"></a>
<a id="__codelineno-10-26" name="__codelineno-10-26"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">isRequired</span><span class="p">()</span>
<a id="__codelineno-10-27" name="__codelineno-10-27"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-10-28" name="__codelineno-10-28"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-10-29" name="__codelineno-10-29"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-10-30" name="__codelineno-10-30"></a><span class="w">  </span><span class="p">};</span>
<a id="__codelineno-10-31" name="__codelineno-10-31"></a>
<a id="__codelineno-10-32" name="__codelineno-10-32"></a><span class="p">}</span>
<a id="__codelineno-10-33" name="__codelineno-10-33"></a>
<a id="__codelineno-10-34" name="__codelineno-10-34"></a><span class="n">PassPluginLibraryInfo</span><span class="w"> </span><span class="n">getPassPluginInfo</span><span class="p">()</span>
<a id="__codelineno-10-35" name="__codelineno-10-35"></a><span class="p">{</span>
<a id="__codelineno-10-36" name="__codelineno-10-36"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">callback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[](</span><span class="n">PassBuilder</span><span class="w"> </span><span class="o">&amp;</span><span class="n">PB</span><span class="p">)</span>
<a id="__codelineno-10-37" name="__codelineno-10-37"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-10-38" name="__codelineno-10-38"></a><span class="w">    </span><span class="n">PB</span><span class="p">.</span><span class="n">registerPipelineParsingCallback</span><span class="p">(</span>
<a id="__codelineno-10-39" name="__codelineno-10-39"></a><span class="w">        </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="n">StringRef</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">ModulePassManager</span><span class="w"> </span><span class="o">&amp;</span><span class="n">MPM</span><span class="p">,</span><span class="w"> </span><span class="n">ArrayRef</span><span class="o">&lt;</span><span class="n">PassBuilder</span><span class="o">::</span><span class="n">PipelineElement</span><span class="o">&gt;</span><span class="p">)</span>
<a id="__codelineno-10-40" name="__codelineno-10-40"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-10-41" name="__codelineno-10-41"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"run-pass"</span><span class="p">)</span>
<a id="__codelineno-10-42" name="__codelineno-10-42"></a><span class="w">          </span><span class="p">{</span>
<a id="__codelineno-10-43" name="__codelineno-10-43"></a><span class="w">            </span><span class="n">MPM</span><span class="p">.</span><span class="n">addPass</span><span class="p">(</span><span class="n">GlobalVarsPass</span><span class="p">());</span>
<a id="__codelineno-10-44" name="__codelineno-10-44"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-10-45" name="__codelineno-10-45"></a><span class="w">          </span><span class="p">}</span>
<a id="__codelineno-10-46" name="__codelineno-10-46"></a><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-10-47" name="__codelineno-10-47"></a><span class="w">        </span><span class="p">});</span>
<a id="__codelineno-10-48" name="__codelineno-10-48"></a><span class="w">  </span><span class="p">};</span>
<a id="__codelineno-10-49" name="__codelineno-10-49"></a>
<a id="__codelineno-10-50" name="__codelineno-10-50"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="n">LLVM_PLUGIN_API_VERSION</span><span class="p">,</span><span class="w"> </span><span class="s">"GlobalVarsPass"</span><span class="p">,</span><span class="w"> </span><span class="n">LLVM_VERSION_STRING</span><span class="p">,</span><span class="w"> </span><span class="n">callback</span><span class="p">};</span>
<a id="__codelineno-10-51" name="__codelineno-10-51"></a><span class="p">};</span>
<a id="__codelineno-10-52" name="__codelineno-10-52"></a>
<a id="__codelineno-10-53" name="__codelineno-10-53"></a><span class="k">extern</span><span class="w"> </span><span class="s">"C"</span><span class="w"> </span><span class="n">LLVM_ATTRIBUTE_WEAK</span><span class="w"> </span><span class="n">PassPluginLibraryInfo</span><span class="w"> </span><span class="n">llvmGetPassPluginInfo</span><span class="p">()</span>
<a id="__codelineno-10-54" name="__codelineno-10-54"></a><span class="p">{</span>
<a id="__codelineno-10-55" name="__codelineno-10-55"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">getPassPluginInfo</span><span class="p">();</span>
<a id="__codelineno-10-56" name="__codelineno-10-56"></a><span class="p">}</span>
</code></pre></div></td></tr></tbody></table></div><p></p>
<p>test.c例子:</p>
<div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span>
<span class="normal"><a href="#__codelineno-11-12">12</a></span>
<span class="normal"><a href="#__codelineno-11-13">13</a></span>
<span class="normal"><a href="#__codelineno-11-14">14</a></span>
<span class="normal"><a href="#__codelineno-11-15">15</a></span>
<span class="normal"><a href="#__codelineno-11-16">16</a></span>
<span class="normal"><a href="#__codelineno-11-17">17</a></span>
<span class="normal"><a href="#__codelineno-11-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="kt">int</span><span class="w"> </span><span class="n">varOne</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1337</span><span class="p">;</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"sh4dy"</span><span class="p">;</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="kt">char</span><span class="w"> </span><span class="n">chr</span><span class="p">;</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="kt">float</span><span class="w"> </span><span class="n">num</span><span class="p">;</span>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="kt">void</span><span class="w"> </span><span class="nf">testFunction</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">){</span>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="o">==</span><span class="mi">1337</span><span class="p">){</span>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="w">        </span><span class="n">puts</span><span class="p">(</span><span class="s">"nice one"</span><span class="p">);</span>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="w">    </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<a id="__codelineno-11-12" name="__codelineno-11-12"></a><span class="w">        </span><span class="n">puts</span><span class="p">(</span><span class="s">"sad"</span><span class="p">);</span>
<a id="__codelineno-11-13" name="__codelineno-11-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-11-14" name="__codelineno-11-14"></a><span class="p">}</span>
<a id="__codelineno-11-15" name="__codelineno-11-15"></a>
<a id="__codelineno-11-16" name="__codelineno-11-16"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span>
<a id="__codelineno-11-17" name="__codelineno-11-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-11-18" name="__codelineno-11-18"></a><span class="p">}</span>
</code></pre></div></td></tr></tbody></table></div>
<p>我们来看一下怎么编译执行：
</p><div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span>
<span class="normal"><a href="#__codelineno-12-3">3</a></span>
<span class="normal"><a href="#__codelineno-12-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a>clang-16<span class="w"> </span>-shared<span class="w"> </span>-o<span class="w"> </span>lib.so<span class="w"> </span>main.cpp<span class="w"> </span>-fPIC
<a id="__codelineno-12-3" name="__codelineno-12-3"></a>clang-16<span class="w"> </span>-S<span class="w"> </span>-emit-llvm<span class="w"> </span>test.c<span class="w"> </span>-o<span class="w"> </span>test.ll
<a id="__codelineno-12-4" name="__codelineno-12-4"></a>opt-16<span class="w"> </span>-load-pass-plugin<span class="w"> </span>./lib.so<span class="w"> </span>-passes<span class="o">=</span>run-pass<span class="w"> </span>-disable-output<span class="w"> </span>test.ll
</code></pre></div></td></tr></tbody></table></div><p></p>
<p>运行结果：
</p><div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-13-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-13-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-13-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-13-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-13-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-13-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-13-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-13-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-13-10">10</a></span>
<span class="normal"><a href="#__codelineno-13-11">11</a></span>
<span class="normal"><a href="#__codelineno-13-12">12</a></span>
<span class="normal"><a href="#__codelineno-13-13">13</a></span>
<span class="normal"><a href="#__codelineno-13-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a>Variable<span class="w"> </span>Name:<span class="w"> </span>varOne
<a id="__codelineno-13-2" name="__codelineno-13-2"></a>Variable<span class="w"> </span>Type:<span class="w"> </span>ptr
<a id="__codelineno-13-3" name="__codelineno-13-3"></a>Variable<span class="w"> </span>Name:<span class="w"> </span>.str
<a id="__codelineno-13-4" name="__codelineno-13-4"></a>Variable<span class="w"> </span>Type:<span class="w"> </span>ptr
<a id="__codelineno-13-5" name="__codelineno-13-5"></a>Variable<span class="w"> </span>Name:<span class="w"> </span>name
<a id="__codelineno-13-6" name="__codelineno-13-6"></a>Variable<span class="w"> </span>Type:<span class="w"> </span>ptr
<a id="__codelineno-13-7" name="__codelineno-13-7"></a>Variable<span class="w"> </span>Name:<span class="w"> </span>.str.1
<a id="__codelineno-13-8" name="__codelineno-13-8"></a>Variable<span class="w"> </span>Type:<span class="w"> </span>ptr
<a id="__codelineno-13-9" name="__codelineno-13-9"></a>Variable<span class="w"> </span>Name:<span class="w"> </span>.str.2
<a id="__codelineno-13-10" name="__codelineno-13-10"></a>Variable<span class="w"> </span>Type:<span class="w"> </span>ptr
<a id="__codelineno-13-11" name="__codelineno-13-11"></a>Variable<span class="w"> </span>Name:<span class="w"> </span>chr
<a id="__codelineno-13-12" name="__codelineno-13-12"></a>Variable<span class="w"> </span>Type:<span class="w"> </span>ptr
<a id="__codelineno-13-13" name="__codelineno-13-13"></a>Variable<span class="w"> </span>Name:<span class="w"> </span>num
<a id="__codelineno-13-14" name="__codelineno-13-14"></a>Variable<span class="w"> </span>Type:<span class="w"> </span>ptr
</code></pre></div></td></tr></tbody></table></div><p></p>
<h3 id="pass-example2-检测没有使用过的全局变量">Pass example2: 检测没有使用过的全局变量<a class="headerlink" href="#pass-example2-检测没有使用过的全局变量" title="Permanent link">¶</a></h3>
<p>实现原理：这段代码遍历所有全局变量并调用use_empty函数。如果该值没有使用者，这个函数将返回 true。</p>
<p></p><div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="n">PreservedAnalyses</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="n">Module</span><span class="w"> </span><span class="o">&amp;</span><span class="n">M</span><span class="p">,</span><span class="w"> </span><span class="n">ModuleAnalysisManager</span><span class="w"> </span><span class="o">&amp;</span><span class="n">MPM</span><span class="p">)</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="p">{</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">globalVars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M</span><span class="p">.</span><span class="n">globals</span><span class="p">();</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="n">GlobalVariable</span><span class="w"> </span><span class="o">&amp;</span><span class="n">gvar</span><span class="o">:</span><span class="w"> </span><span class="n">globalVars</span><span class="p">){</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">gvar</span><span class="p">.</span><span class="n">use_empty</span><span class="p">()){</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="w">        </span><span class="n">outs</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="s">"Unused global variable: "</span><span class="o">&lt;&lt;</span><span class="n">gvar</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">PreservedAnalyses</span><span class="o">::</span><span class="n">all</span><span class="p">();</span>
<a id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="p">}</span>
</code></pre></div></td></tr></tbody></table></div>
还是上面的执行方法和test.c例子哈，运行结果将会是：
<div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span>
<span class="normal"><a href="#__codelineno-15-2">2</a></span>
<span class="normal"><a href="#__codelineno-15-3">3</a></span>
<span class="normal"><a href="#__codelineno-15-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a>Unused<span class="w"> </span>global<span class="w"> </span>variable:<span class="w"> </span>varOne
<a id="__codelineno-15-2" name="__codelineno-15-2"></a>Unused<span class="w"> </span>global<span class="w"> </span>variable:<span class="w"> </span>name
<a id="__codelineno-15-3" name="__codelineno-15-3"></a>Unused<span class="w"> </span>global<span class="w"> </span>variable:<span class="w"> </span>chr
<a id="__codelineno-15-4" name="__codelineno-15-4"></a>Unused<span class="w"> </span>global<span class="w"> </span>variable:<span class="w"> </span>num
</code></pre></div></td></tr></tbody></table></div><p></p>
<h3 id="pass-example3-打印函数内所有基本块">Pass example3: 打印函数内所有基本块<a class="headerlink" href="#pass-example3-打印函数内所有基本块" title="Permanent link">¶</a></h3>
<p>编写一个用于计算并打印函数内所有基本块的LLVM pass涉及遍历模块中的每个函数，然后检查这些函数中的每个基本块。重要的是要<strong>检查函数是否只是一个声明</strong>，通过isDeclaration函数实现，因为模块通常包含代码中使用的库函数的声明，但它们的完整实现并不在这个模块中。通过检查声明，我们可以避免尝试分析在该模块中没有实际代码的函数。</p>
<div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-16-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-16-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-16-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-16-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-16-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-16-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-16-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-16-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-16-10">10</a></span>
<span class="normal"><a href="#__codelineno-16-11">11</a></span>
<span class="normal"><a href="#__codelineno-16-12">12</a></span>
<span class="normal"><a href="#__codelineno-16-13">13</a></span>
<span class="normal"><a href="#__codelineno-16-14">14</a></span>
<span class="normal"><a href="#__codelineno-16-15">15</a></span>
<span class="normal"><a href="#__codelineno-16-16">16</a></span>
<span class="normal"><a href="#__codelineno-16-17">17</a></span>
<span class="normal"><a href="#__codelineno-16-18">18</a></span>
<span class="normal"><a href="#__codelineno-16-19">19</a></span>
<span class="normal"><a href="#__codelineno-16-20">20</a></span>
<span class="normal"><a href="#__codelineno-16-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="c1">// main.cpp部分代码</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="n">PreservedAnalyses</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="n">Module</span><span class="w"> </span><span class="o">&amp;</span><span class="n">M</span><span class="p">,</span><span class="w"> </span><span class="n">ModuleAnalysisManager</span><span class="w"> </span><span class="o">&amp;</span><span class="n">MPM</span><span class="p">)</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="p">{</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Function</span><span class="w"> </span><span class="o">&amp;</span><span class="n">F</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">M</span><span class="p">)</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">F</span><span class="p">.</span><span class="n">isDeclaration</span><span class="p">())</span>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">nBlocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="w">            </span><span class="n">outs</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"----------------------------------------------------------------------</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="w">            </span><span class="n">outs</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Counting and printing basic blocks in the function "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">F</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">BasicBlock</span><span class="w"> </span><span class="o">&amp;</span><span class="n">BB</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="p">)</span>
<a id="__codelineno-16-12" name="__codelineno-16-12"></a><span class="w">            </span><span class="p">{</span>
<a id="__codelineno-16-13" name="__codelineno-16-13"></a><span class="w">                </span><span class="n">BB</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">outs</span><span class="p">());</span>
<a id="__codelineno-16-14" name="__codelineno-16-14"></a><span class="w">                </span><span class="n">outs</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-16-15" name="__codelineno-16-15"></a><span class="w">                </span><span class="n">nBlocks</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-16-16" name="__codelineno-16-16"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-16-17" name="__codelineno-16-17"></a><span class="w">            </span><span class="n">outs</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Number of basic blocks: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">nBlocks</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-16-18" name="__codelineno-16-18"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-16-19" name="__codelineno-16-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-16-20" name="__codelineno-16-20"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">PreservedAnalyses</span><span class="o">::</span><span class="n">all</span><span class="p">();</span>
<a id="__codelineno-16-21" name="__codelineno-16-21"></a><span class="p">}</span>
</code></pre></div></td></tr></tbody></table></div>
<p>test.c例子：
</p><div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">C</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-17-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-17-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-17-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-17-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-17-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-17-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-17-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-17-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-17-10">10</a></span>
<span class="normal"><a href="#__codelineno-17-11">11</a></span>
<span class="normal"><a href="#__codelineno-17-12">12</a></span>
<span class="normal"><a href="#__codelineno-17-13">13</a></span>
<span class="normal"><a href="#__codelineno-17-14">14</a></span>
<span class="normal"><a href="#__codelineno-17-15">15</a></span>
<span class="normal"><a href="#__codelineno-17-16">16</a></span>
<span class="normal"><a href="#__codelineno-17-17">17</a></span>
<span class="normal"><a href="#__codelineno-17-18">18</a></span>
<span class="normal"><a href="#__codelineno-17-19">19</a></span>
<span class="normal"><a href="#__codelineno-17-20">20</a></span>
<span class="normal"><a href="#__codelineno-17-21">21</a></span>
<span class="normal"><a href="#__codelineno-17-22">22</a></span>
<span class="normal"><a href="#__codelineno-17-23">23</a></span>
<span class="normal"><a href="#__codelineno-17-24">24</a></span>
<span class="normal"><a href="#__codelineno-17-25">25</a></span>
<span class="normal"><a href="#__codelineno-17-26">26</a></span>
<span class="normal"><a href="#__codelineno-17-27">27</a></span>
<span class="normal"><a href="#__codelineno-17-28">28</a></span>
<span class="normal"><a href="#__codelineno-17-29">29</a></span>
<span class="normal"><a href="#__codelineno-17-30">30</a></span>
<span class="normal"><a href="#__codelineno-17-31">31</a></span>
<span class="normal"><a href="#__codelineno-17-32">32</a></span>
<span class="normal"><a href="#__codelineno-17-33">33</a></span>
<span class="normal"><a href="#__codelineno-17-34">34</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="kt">void</span><span class="w"> </span><span class="nf">testFunction</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="p">{</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1337</span><span class="p">)</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="w">        </span><span class="n">puts</span><span class="p">(</span><span class="s">"nice one"</span><span class="p">);</span>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-17-10" name="__codelineno-17-10"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-17-11" name="__codelineno-17-11"></a><span class="w">        </span><span class="n">puts</span><span class="p">(</span><span class="s">"sad"</span><span class="p">);</span>
<a id="__codelineno-17-12" name="__codelineno-17-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-17-13" name="__codelineno-17-13"></a><span class="p">}</span>
<a id="__codelineno-17-14" name="__codelineno-17-14"></a>
<a id="__codelineno-17-15" name="__codelineno-17-15"></a><span class="kt">void</span><span class="w"> </span><span class="nf">someFunction</span><span class="p">()</span>
<a id="__codelineno-17-16" name="__codelineno-17-16"></a><span class="p">{</span>
<a id="__codelineno-17-17" name="__codelineno-17-17"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-17-18" name="__codelineno-17-18"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-17-19" name="__codelineno-17-19"></a><span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-17-20" name="__codelineno-17-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-17-21" name="__codelineno-17-21"></a><span class="p">}</span>
<a id="__codelineno-17-22" name="__codelineno-17-22"></a>
<a id="__codelineno-17-23" name="__codelineno-17-23"></a><span class="kt">void</span><span class="w"> </span><span class="nf">anotherFunction</span><span class="p">()</span>
<a id="__codelineno-17-24" name="__codelineno-17-24"></a><span class="p">{</span>
<a id="__codelineno-17-25" name="__codelineno-17-25"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-17-26" name="__codelineno-17-26"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-17-27" name="__codelineno-17-27"></a><span class="w">        </span><span class="n">puts</span><span class="p">(</span><span class="s">"abcd"</span><span class="p">);</span>
<a id="__codelineno-17-28" name="__codelineno-17-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-17-29" name="__codelineno-17-29"></a><span class="p">}</span>
<a id="__codelineno-17-30" name="__codelineno-17-30"></a>
<a id="__codelineno-17-31" name="__codelineno-17-31"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-17-32" name="__codelineno-17-32"></a><span class="p">{</span>
<a id="__codelineno-17-33" name="__codelineno-17-33"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-17-34" name="__codelineno-17-34"></a><span class="p">}</span>
</code></pre></div></td></tr></tbody></table></div><p></p>
<p>运行结果太长，部门内容如下，会打印每个函数的基本块：
</p><div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span>
<span class="normal"><a href="#__codelineno-18-2">2</a></span>
<span class="normal"><a href="#__codelineno-18-3">3</a></span>
<span class="normal"><a href="#__codelineno-18-4">4</a></span>
<span class="normal"><a href="#__codelineno-18-5">5</a></span>
<span class="normal"><a href="#__codelineno-18-6">6</a></span>
<span class="normal"><a href="#__codelineno-18-7">7</a></span>
<span class="normal"><a href="#__codelineno-18-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a>----------------------------------------------------------------------
<a id="__codelineno-18-2" name="__codelineno-18-2"></a>Counting<span class="w"> </span>and<span class="w"> </span>printing<span class="w"> </span>basic<span class="w"> </span>blocks<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span><span class="k">function</span><span class="w"> </span>main
<a id="__codelineno-18-3" name="__codelineno-18-3"></a>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="w">  </span>%1<span class="w"> </span><span class="o">=</span><span class="w"> </span>alloca<span class="w"> </span>i32,<span class="w"> </span>align<span class="w"> </span><span class="m">4</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="w">  </span>store<span class="w"> </span>i32<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>ptr<span class="w"> </span>%1,<span class="w"> </span>align<span class="w"> </span><span class="m">4</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="w">  </span>ret<span class="w"> </span>i32<span class="w"> </span><span class="m">0</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a>Number<span class="w"> </span>of<span class="w"> </span>basic<span class="w"> </span>blocks:<span class="w"> </span><span class="m">1</span>
</code></pre></div></td></tr></tbody></table></div><p></p>
<h3 id="pass-example4-检测递归">Pass example4: 检测递归<a class="headerlink" href="#pass-example4-检测递归" title="Permanent link">¶</a></h3>
<div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-19-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-19-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-19-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-19-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-19-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-19-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-19-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-19-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-19-10">10</a></span>
<span class="normal"><a href="#__codelineno-19-11">11</a></span>
<span class="normal"><a href="#__codelineno-19-12">12</a></span>
<span class="normal"><a href="#__codelineno-19-13">13</a></span>
<span class="normal"><a href="#__codelineno-19-14">14</a></span>
<span class="normal"><a href="#__codelineno-19-15">15</a></span>
<span class="normal"><a href="#__codelineno-19-16">16</a></span>
<span class="normal"><a href="#__codelineno-19-17">17</a></span>
<span class="normal"><a href="#__codelineno-19-18">18</a></span>
<span class="normal"><a href="#__codelineno-19-19">19</a></span>
<span class="normal"><a href="#__codelineno-19-20">20</a></span>
<span class="normal"><a href="#__codelineno-19-21">21</a></span>
<span class="normal"><a href="#__codelineno-19-22">22</a></span>
<span class="normal"><a href="#__codelineno-19-23">23</a></span>
<span class="normal"><a href="#__codelineno-19-24">24</a></span>
<span class="normal"><a href="#__codelineno-19-25">25</a></span>
<span class="normal"><a href="#__codelineno-19-26">26</a></span>
<span class="normal"><a href="#__codelineno-19-27">27</a></span>
<span class="normal"><a href="#__codelineno-19-28">28</a></span>
<span class="normal"><a href="#__codelineno-19-29">29</a></span>
<span class="normal"><a href="#__codelineno-19-30">30</a></span>
<span class="normal"><a href="#__codelineno-19-31">31</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="n">PreservedAnalyses</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="n">Module</span><span class="w"> </span><span class="o">&amp;</span><span class="n">M</span><span class="p">,</span><span class="w"> </span><span class="n">ModuleAnalysisManager</span><span class="w"> </span><span class="o">&amp;</span><span class="n">MPM</span><span class="p">)</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="p">{</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Function</span><span class="w"> </span><span class="o">&amp;</span><span class="n">F</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">M</span><span class="p">)</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">recursionDetected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">BasicBlock</span><span class="w"> </span><span class="o">&amp;</span><span class="n">BB</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="p">)</span>
<a id="__codelineno-19-8" name="__codelineno-19-8"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-19-9" name="__codelineno-19-9"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Instruction</span><span class="w"> </span><span class="o">&amp;</span><span class="n">instr</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">BB</span><span class="p">)</span>
<a id="__codelineno-19-10" name="__codelineno-19-10"></a><span class="w">      </span><span class="p">{</span>
<a id="__codelineno-19-11" name="__codelineno-19-11"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">instr</span><span class="p">.</span><span class="n">getOpcode</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Instruction</span><span class="o">::</span><span class="n">Call</span><span class="p">)</span>
<a id="__codelineno-19-12" name="__codelineno-19-12"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-19-13" name="__codelineno-19-13"></a><span class="w">          </span><span class="n">CallInst</span><span class="w"> </span><span class="o">*</span><span class="n">callInstr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dyn_cast</span><span class="o">&lt;</span><span class="n">CallInst</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">instr</span><span class="p">);</span>
<a id="__codelineno-19-14" name="__codelineno-19-14"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">callInstr</span><span class="p">)</span>
<a id="__codelineno-19-15" name="__codelineno-19-15"></a><span class="w">          </span><span class="p">{</span>
<a id="__codelineno-19-16" name="__codelineno-19-16"></a><span class="w">            </span><span class="n">Function</span><span class="w"> </span><span class="o">*</span><span class="n">calledFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">callInstr</span><span class="o">-&gt;</span><span class="n">getCalledFunction</span><span class="p">();</span>
<a id="__codelineno-19-17" name="__codelineno-19-17"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">calledFunction</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">calledFunction</span><span class="o">-&gt;</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">F</span><span class="p">.</span><span class="n">getName</span><span class="p">())</span>
<a id="__codelineno-19-18" name="__codelineno-19-18"></a><span class="w">            </span><span class="p">{</span>
<a id="__codelineno-19-19" name="__codelineno-19-19"></a><span class="w">              </span><span class="n">outs</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Recursion detected: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">calledFunction</span><span class="o">-&gt;</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-19-20" name="__codelineno-19-20"></a><span class="w">              </span><span class="n">recursionDetected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-19-21" name="__codelineno-19-21"></a><span class="w">              </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-19-22" name="__codelineno-19-22"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-19-23" name="__codelineno-19-23"></a><span class="w">          </span><span class="p">}</span>
<a id="__codelineno-19-24" name="__codelineno-19-24"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-19-25" name="__codelineno-19-25"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-19-26" name="__codelineno-19-26"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">recursionDetected</span><span class="p">)</span>
<a id="__codelineno-19-27" name="__codelineno-19-27"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-19-28" name="__codelineno-19-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-19-29" name="__codelineno-19-29"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-19-30" name="__codelineno-19-30"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">PreservedAnalyses</span><span class="o">::</span><span class="n">all</span><span class="p">();</span>
<a id="__codelineno-19-31" name="__codelineno-19-31"></a><span class="p">}</span>
</code></pre></div></td></tr></tbody></table></div>
<p>test.c例子：
</p><div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">C</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span>
<span class="normal"><a href="#__codelineno-20-11">11</a></span>
<span class="normal"><a href="#__codelineno-20-12">12</a></span>
<span class="normal"><a href="#__codelineno-20-13">13</a></span>
<span class="normal"><a href="#__codelineno-20-14">14</a></span>
<span class="normal"><a href="#__codelineno-20-15">15</a></span>
<span class="normal"><a href="#__codelineno-20-16">16</a></span>
<span class="normal"><a href="#__codelineno-20-17">17</a></span>
<span class="normal"><a href="#__codelineno-20-18">18</a></span>
<span class="normal"><a href="#__codelineno-20-19">19</a></span>
<span class="normal"><a href="#__codelineno-20-20">20</a></span>
<span class="normal"><a href="#__codelineno-20-21">21</a></span>
<span class="normal"><a href="#__codelineno-20-22">22</a></span>
<span class="normal"><a href="#__codelineno-20-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">fib</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="p">{</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="p">}</span>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="kt">int</span><span class="w"> </span><span class="nf">testFunction</span><span class="p">()</span>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="p">{</span>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="p">}</span>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a>
<a id="__codelineno-20-13" name="__codelineno-20-13"></a><span class="kt">void</span><span class="w"> </span><span class="nf">anotherFunction</span><span class="p">()</span>
<a id="__codelineno-20-14" name="__codelineno-20-14"></a><span class="p">{</span>
<a id="__codelineno-20-15" name="__codelineno-20-15"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-20-16" name="__codelineno-20-16"></a><span class="w">        </span><span class="p">;</span>
<a id="__codelineno-20-17" name="__codelineno-20-17"></a><span class="p">}</span>
<a id="__codelineno-20-18" name="__codelineno-20-18"></a>
<a id="__codelineno-20-19" name="__codelineno-20-19"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-20-20" name="__codelineno-20-20"></a><span class="p">{</span>
<a id="__codelineno-20-21" name="__codelineno-20-21"></a><span class="w">    </span><span class="n">fib</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<a id="__codelineno-20-22" name="__codelineno-20-22"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-20-23" name="__codelineno-20-23"></a><span class="p">}</span>
</code></pre></div></td></tr></tbody></table></div><p></p>
<p>运行结果：
</p><div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a>Recursion<span class="w"> </span>detected:<span class="w"> </span>fib
</code></pre></div></td></tr></tbody></table></div><p></p>
<h3 id="pass-example5-对控制流图进行深度优先搜索dfs">Pass example5: 对控制流图进行深度优先搜索（DFS）<a class="headerlink" href="#pass-example5-对控制流图进行深度优先搜索dfs" title="Permanent link">¶</a></h3>
<p>对于每个函数，我们可以使用F.getEntryBlock()获取第一个基本块，也称为入口块。然后我们调用下面提到的Dfs函数。</p>
<div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span>
<span class="normal"><a href="#__codelineno-22-12">12</a></span>
<span class="normal"><a href="#__codelineno-22-13">13</a></span>
<span class="normal"><a href="#__codelineno-22-14">14</a></span>
<span class="normal"><a href="#__codelineno-22-15">15</a></span>
<span class="normal"><a href="#__codelineno-22-16">16</a></span>
<span class="normal"><a href="#__codelineno-22-17">17</a></span>
<span class="normal"><a href="#__codelineno-22-18">18</a></span>
<span class="normal"><a href="#__codelineno-22-19">19</a></span>
<span class="normal"><a href="#__codelineno-22-20">20</a></span>
<span class="normal"><a href="#__codelineno-22-21">21</a></span>
<span class="normal"><a href="#__codelineno-22-22">22</a></span>
<span class="normal"><a href="#__codelineno-22-23">23</a></span>
<span class="normal"><a href="#__codelineno-22-24">24</a></span>
<span class="normal"><a href="#__codelineno-22-25">25</a></span>
<span class="normal"><a href="#__codelineno-22-26">26</a></span>
<span class="normal"><a href="#__codelineno-22-27">27</a></span>
<span class="normal"><a href="#__codelineno-22-28">28</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">Dfs</span><span class="p">(</span><span class="n">BasicBlock</span><span class="w"> </span><span class="o">*</span><span class="n">currentBlock</span><span class="p">)</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="p">{</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">BasicBlock</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="o">&gt;</span><span class="w"> </span><span class="n">visited</span><span class="p">;</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="w">  </span><span class="n">visited</span><span class="p">[</span><span class="n">currentBlock</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="w">  </span><span class="n">currentBlock</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">(</span><span class="n">outs</span><span class="p">());</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">BasicBlock</span><span class="w"> </span><span class="o">*</span><span class="n">bb</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">successors</span><span class="p">(</span><span class="n">currentBlock</span><span class="p">))</span>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">visited</span><span class="p">[</span><span class="n">bb</span><span class="p">])</span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="w">        </span><span class="n">Dfs</span><span class="p">(</span><span class="n">bb</span><span class="p">);</span>
<a id="__codelineno-22-11" name="__codelineno-22-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-22-12" name="__codelineno-22-12"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-22-13" name="__codelineno-22-13"></a><span class="p">}</span>
<a id="__codelineno-22-14" name="__codelineno-22-14"></a>
<a id="__codelineno-22-15" name="__codelineno-22-15"></a><span class="n">PreservedAnalyses</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="n">Module</span><span class="w"> </span><span class="o">&amp;</span><span class="n">M</span><span class="p">,</span><span class="w"> </span><span class="n">ModuleAnalysisManager</span><span class="w"> </span><span class="o">&amp;</span><span class="n">MPM</span><span class="p">)</span>
<a id="__codelineno-22-16" name="__codelineno-22-16"></a><span class="p">{</span>
<a id="__codelineno-22-17" name="__codelineno-22-17"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Function</span><span class="w"> </span><span class="o">&amp;</span><span class="n">F</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">M</span><span class="p">)</span>
<a id="__codelineno-22-18" name="__codelineno-22-18"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-22-19" name="__codelineno-22-19"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">F</span><span class="p">.</span><span class="n">isDeclaration</span><span class="p">())</span>
<a id="__codelineno-22-20" name="__codelineno-22-20"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-22-21" name="__codelineno-22-21"></a><span class="w">      </span><span class="n">outs</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"----------------------------------------------------------------</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-22-22" name="__codelineno-22-22"></a><span class="w">      </span><span class="n">outs</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Running DFS for the function "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">F</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a id="__codelineno-22-23" name="__codelineno-22-23"></a><span class="w">      </span><span class="n">BasicBlock</span><span class="w"> </span><span class="o">&amp;</span><span class="n">entryBlock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="p">.</span><span class="n">getEntryBlock</span><span class="p">();</span>
<a id="__codelineno-22-24" name="__codelineno-22-24"></a><span class="w">      </span><span class="n">Dfs</span><span class="p">(</span><span class="o">&amp;</span><span class="n">entryBlock</span><span class="p">);</span>
<a id="__codelineno-22-25" name="__codelineno-22-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-22-26" name="__codelineno-22-26"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-22-27" name="__codelineno-22-27"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">PreservedAnalyses</span><span class="o">::</span><span class="n">all</span><span class="p">();</span>
<a id="__codelineno-22-28" name="__codelineno-22-28"></a><span class="p">}</span>
</code></pre></div></td></tr></tbody></table></div>
<div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span>
<span class="normal"><a href="#__codelineno-23-11">11</a></span>
<span class="normal"><a href="#__codelineno-23-12">12</a></span>
<span class="normal"><a href="#__codelineno-23-13">13</a></span>
<span class="normal"><a href="#__codelineno-23-14">14</a></span>
<span class="normal"><a href="#__codelineno-23-15">15</a></span>
<span class="normal"><a href="#__codelineno-23-16">16</a></span>
<span class="normal"><a href="#__codelineno-23-17">17</a></span>
<span class="normal"><a href="#__codelineno-23-18">18</a></span>
<span class="normal"><a href="#__codelineno-23-19">19</a></span>
<span class="normal"><a href="#__codelineno-23-20">20</a></span>
<span class="normal"><a href="#__codelineno-23-21">21</a></span>
<span class="normal"><a href="#__codelineno-23-22">22</a></span>
<span class="normal"><a href="#__codelineno-23-23">23</a></span>
<span class="normal"><a href="#__codelineno-23-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">testFunction</span><span class="p">()</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="p">{</span>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a><span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-23-8" name="__codelineno-23-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-23-9" name="__codelineno-23-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">1337</span><span class="p">;</span>
<a id="__codelineno-23-10" name="__codelineno-23-10"></a><span class="p">}</span>
<a id="__codelineno-23-11" name="__codelineno-23-11"></a>
<a id="__codelineno-23-12" name="__codelineno-23-12"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<a id="__codelineno-23-13" name="__codelineno-23-13"></a><span class="p">{</span>
<a id="__codelineno-23-14" name="__codelineno-23-14"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testFunction</span><span class="p">();</span>
<a id="__codelineno-23-15" name="__codelineno-23-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span>
<a id="__codelineno-23-16" name="__codelineno-23-16"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-23-17" name="__codelineno-23-17"></a><span class="w">        </span><span class="n">puts</span><span class="p">(</span><span class="s">"Yay"</span><span class="p">);</span>
<a id="__codelineno-23-18" name="__codelineno-23-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-23-19" name="__codelineno-23-19"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-23-20" name="__codelineno-23-20"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-23-21" name="__codelineno-23-21"></a><span class="w">        </span><span class="n">puts</span><span class="p">(</span><span class="s">"Ne"</span><span class="p">);</span>
<a id="__codelineno-23-22" name="__codelineno-23-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-23-23" name="__codelineno-23-23"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-23-24" name="__codelineno-23-24"></a><span class="p">}</span>
</code></pre></div></td></tr></tbody></table></div>
<div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-24-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-24-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-24-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-24-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-24-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-24-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-24-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-24-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-24-10">10</a></span>
<span class="normal"><a href="#__codelineno-24-11">11</a></span>
<span class="normal"><a href="#__codelineno-24-12">12</a></span>
<span class="normal"><a href="#__codelineno-24-13">13</a></span>
<span class="normal"><a href="#__codelineno-24-14">14</a></span>
<span class="normal"><a href="#__codelineno-24-15">15</a></span>
<span class="normal"><a href="#__codelineno-24-16">16</a></span>
<span class="normal"><a href="#__codelineno-24-17">17</a></span>
<span class="normal"><a href="#__codelineno-24-18">18</a></span>
<span class="normal"><a href="#__codelineno-24-19">19</a></span>
<span class="normal"><a href="#__codelineno-24-20">20</a></span>
<span class="normal"><a href="#__codelineno-24-21">21</a></span>
<span class="normal"><a href="#__codelineno-24-22">22</a></span>
<span class="normal"><a href="#__codelineno-24-23">23</a></span>
<span class="normal"><a href="#__codelineno-24-24">24</a></span>
<span class="normal"><a href="#__codelineno-24-25">25</a></span>
<span class="normal"><a href="#__codelineno-24-26">26</a></span>
<span class="normal"><a href="#__codelineno-24-27">27</a></span>
<span class="normal"><a href="#__codelineno-24-28">28</a></span>
<span class="normal"><a href="#__codelineno-24-29">29</a></span>
<span class="normal"><a href="#__codelineno-24-30">30</a></span>
<span class="normal"><a href="#__codelineno-24-31">31</a></span>
<span class="normal"><a href="#__codelineno-24-32">32</a></span>
<span class="normal"><a href="#__codelineno-24-33">33</a></span>
<span class="normal"><a href="#__codelineno-24-34">34</a></span>
<span class="normal"><a href="#__codelineno-24-35">35</a></span>
<span class="normal"><a href="#__codelineno-24-36">36</a></span>
<span class="normal"><a href="#__codelineno-24-37">37</a></span>
<span class="normal"><a href="#__codelineno-24-38">38</a></span>
<span class="normal"><a href="#__codelineno-24-39">39</a></span>
<span class="normal"><a href="#__codelineno-24-40">40</a></span>
<span class="normal"><a href="#__codelineno-24-41">41</a></span>
<span class="normal"><a href="#__codelineno-24-42">42</a></span>
<span class="normal"><a href="#__codelineno-24-43">43</a></span>
<span class="normal"><a href="#__codelineno-24-44">44</a></span>
<span class="normal"><a href="#__codelineno-24-45">45</a></span>
<span class="normal"><a href="#__codelineno-24-46">46</a></span>
<span class="normal"><a href="#__codelineno-24-47">47</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a>----------------------------------------------------------------
<a id="__codelineno-24-2" name="__codelineno-24-2"></a>Running<span class="w"> </span>DFS<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span><span class="k">function</span><span class="w"> </span>testFunction
<a id="__codelineno-24-3" name="__codelineno-24-3"></a>
<a id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="w">  </span>%1<span class="w"> </span><span class="o">=</span><span class="w"> </span>alloca<span class="w"> </span>i32,<span class="w"> </span>align<span class="w"> </span><span class="m">4</span>
<a id="__codelineno-24-5" name="__codelineno-24-5"></a><span class="w">  </span>store<span class="w"> </span>i32<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>ptr<span class="w"> </span>%1,<span class="w"> </span>align<span class="w"> </span><span class="m">4</span>
<a id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="w">  </span>br<span class="w"> </span>label<span class="w"> </span>%2
<a id="__codelineno-24-7" name="__codelineno-24-7"></a>
<a id="__codelineno-24-8" name="__codelineno-24-8"></a><span class="m">2</span>:<span class="w">                                                </span><span class="p">;</span><span class="w"> </span><span class="nv">preds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>%8,<span class="w"> </span>%0
<a id="__codelineno-24-9" name="__codelineno-24-9"></a><span class="w">  </span>%3<span class="w"> </span><span class="o">=</span><span class="w"> </span>load<span class="w"> </span>i32,<span class="w"> </span>ptr<span class="w"> </span>%1,<span class="w"> </span>align<span class="w"> </span><span class="m">4</span>
<a id="__codelineno-24-10" name="__codelineno-24-10"></a><span class="w">  </span>%4<span class="w"> </span><span class="o">=</span><span class="w"> </span>icmp<span class="w"> </span>slt<span class="w"> </span>i32<span class="w"> </span>%3,<span class="w"> </span><span class="m">10</span>
<a id="__codelineno-24-11" name="__codelineno-24-11"></a><span class="w">  </span>br<span class="w"> </span>i1<span class="w"> </span>%4,<span class="w"> </span>label<span class="w"> </span>%5,<span class="w"> </span>label<span class="w"> </span>%11
<a id="__codelineno-24-12" name="__codelineno-24-12"></a>
<a id="__codelineno-24-13" name="__codelineno-24-13"></a><span class="m">5</span>:<span class="w">                                                </span><span class="p">;</span><span class="w"> </span><span class="nv">preds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>%2
<a id="__codelineno-24-14" name="__codelineno-24-14"></a><span class="w">  </span>%6<span class="w"> </span><span class="o">=</span><span class="w"> </span>load<span class="w"> </span>i32,<span class="w"> </span>ptr<span class="w"> </span>%1,<span class="w"> </span>align<span class="w"> </span><span class="m">4</span>
<a id="__codelineno-24-15" name="__codelineno-24-15"></a><span class="w">  </span>%7<span class="w"> </span><span class="o">=</span><span class="w"> </span>call<span class="w"> </span>i32<span class="w"> </span><span class="o">(</span>ptr,<span class="w"> </span>...<span class="o">)</span><span class="w"> </span>@printf<span class="o">(</span>ptr<span class="w"> </span>noundef<span class="w"> </span>@.str,<span class="w"> </span>i32<span class="w"> </span>noundef<span class="w"> </span>%6<span class="o">)</span>
<a id="__codelineno-24-16" name="__codelineno-24-16"></a><span class="w">  </span>br<span class="w"> </span>label<span class="w"> </span>%8
<a id="__codelineno-24-17" name="__codelineno-24-17"></a>
<a id="__codelineno-24-18" name="__codelineno-24-18"></a><span class="m">8</span>:<span class="w">                                                </span><span class="p">;</span><span class="w"> </span><span class="nv">preds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>%5
<a id="__codelineno-24-19" name="__codelineno-24-19"></a><span class="w">  </span>%9<span class="w"> </span><span class="o">=</span><span class="w"> </span>load<span class="w"> </span>i32,<span class="w"> </span>ptr<span class="w"> </span>%1,<span class="w"> </span>align<span class="w"> </span><span class="m">4</span>
<a id="__codelineno-24-20" name="__codelineno-24-20"></a><span class="w">  </span>%10<span class="w"> </span><span class="o">=</span><span class="w"> </span>add<span class="w"> </span>nsw<span class="w"> </span>i32<span class="w"> </span>%9,<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-24-21" name="__codelineno-24-21"></a><span class="w">  </span>store<span class="w"> </span>i32<span class="w"> </span>%10,<span class="w"> </span>ptr<span class="w"> </span>%1,<span class="w"> </span>align<span class="w"> </span><span class="m">4</span>
<a id="__codelineno-24-22" name="__codelineno-24-22"></a><span class="w">  </span>br<span class="w"> </span>label<span class="w"> </span>%2,<span class="w"> </span>!llvm.loop<span class="w"> </span>!6
<a id="__codelineno-24-23" name="__codelineno-24-23"></a>
<a id="__codelineno-24-24" name="__codelineno-24-24"></a><span class="m">11</span>:<span class="w">                                               </span><span class="p">;</span><span class="w"> </span><span class="nv">preds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>%2
<a id="__codelineno-24-25" name="__codelineno-24-25"></a><span class="w">  </span>ret<span class="w"> </span>i32<span class="w"> </span><span class="m">1337</span>
<a id="__codelineno-24-26" name="__codelineno-24-26"></a>----------------------------------------------------------------
<a id="__codelineno-24-27" name="__codelineno-24-27"></a>Running<span class="w"> </span>DFS<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span><span class="k">function</span><span class="w"> </span>main
<a id="__codelineno-24-28" name="__codelineno-24-28"></a>
<a id="__codelineno-24-29" name="__codelineno-24-29"></a><span class="w">  </span>%1<span class="w"> </span><span class="o">=</span><span class="w"> </span>alloca<span class="w"> </span>i32,<span class="w"> </span>align<span class="w"> </span><span class="m">4</span>
<a id="__codelineno-24-30" name="__codelineno-24-30"></a><span class="w">  </span>%2<span class="w"> </span><span class="o">=</span><span class="w"> </span>alloca<span class="w"> </span>i32,<span class="w"> </span>align<span class="w"> </span><span class="m">4</span>
<a id="__codelineno-24-31" name="__codelineno-24-31"></a><span class="w">  </span>store<span class="w"> </span>i32<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>ptr<span class="w"> </span>%1,<span class="w"> </span>align<span class="w"> </span><span class="m">4</span>
<a id="__codelineno-24-32" name="__codelineno-24-32"></a><span class="w">  </span>%3<span class="w"> </span><span class="o">=</span><span class="w"> </span>call<span class="w"> </span>i32<span class="w"> </span>@testFunction<span class="o">()</span>
<a id="__codelineno-24-33" name="__codelineno-24-33"></a><span class="w">  </span>store<span class="w"> </span>i32<span class="w"> </span>%3,<span class="w"> </span>ptr<span class="w"> </span>%2,<span class="w"> </span>align<span class="w"> </span><span class="m">4</span>
<a id="__codelineno-24-34" name="__codelineno-24-34"></a><span class="w">  </span>%4<span class="w"> </span><span class="o">=</span><span class="w"> </span>load<span class="w"> </span>i32,<span class="w"> </span>ptr<span class="w"> </span>%2,<span class="w"> </span>align<span class="w"> </span><span class="m">4</span>
<a id="__codelineno-24-35" name="__codelineno-24-35"></a><span class="w">  </span>%5<span class="w"> </span><span class="o">=</span><span class="w"> </span>icmp<span class="w"> </span>sgt<span class="w"> </span>i32<span class="w"> </span>%4,<span class="w"> </span><span class="m">1000</span>
<a id="__codelineno-24-36" name="__codelineno-24-36"></a><span class="w">  </span>br<span class="w"> </span>i1<span class="w"> </span>%5,<span class="w"> </span>label<span class="w"> </span>%6,<span class="w"> </span>label<span class="w"> </span>%8
<a id="__codelineno-24-37" name="__codelineno-24-37"></a>
<a id="__codelineno-24-38" name="__codelineno-24-38"></a><span class="m">6</span>:<span class="w">                                                </span><span class="p">;</span><span class="w"> </span><span class="nv">preds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>%0
<a id="__codelineno-24-39" name="__codelineno-24-39"></a><span class="w">  </span>%7<span class="w"> </span><span class="o">=</span><span class="w"> </span>call<span class="w"> </span>i32<span class="w"> </span>@puts<span class="o">(</span>ptr<span class="w"> </span>noundef<span class="w"> </span>@.str.1<span class="o">)</span>
<a id="__codelineno-24-40" name="__codelineno-24-40"></a><span class="w">  </span>br<span class="w"> </span>label<span class="w"> </span>%10
<a id="__codelineno-24-41" name="__codelineno-24-41"></a>
<a id="__codelineno-24-42" name="__codelineno-24-42"></a><span class="m">10</span>:<span class="w">                                               </span><span class="p">;</span><span class="w"> </span><span class="nv">preds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>%8,<span class="w"> </span>%6
<a id="__codelineno-24-43" name="__codelineno-24-43"></a><span class="w">  </span>ret<span class="w"> </span>i32<span class="w"> </span><span class="m">0</span>
<a id="__codelineno-24-44" name="__codelineno-24-44"></a>
<a id="__codelineno-24-45" name="__codelineno-24-45"></a><span class="m">8</span>:<span class="w">                                                </span><span class="p">;</span><span class="w"> </span><span class="nv">preds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>%0
<a id="__codelineno-24-46" name="__codelineno-24-46"></a><span class="w">  </span>%9<span class="w"> </span><span class="o">=</span><span class="w"> </span>call<span class="w"> </span>i32<span class="w"> </span>@puts<span class="o">(</span>ptr<span class="w"> </span>noundef<span class="w"> </span>@.str.2<span class="o">)</span>
<a id="__codelineno-24-47" name="__codelineno-24-47"></a><span class="w">  </span>br<span class="w"> </span>label<span class="w"> </span>%10
</code></pre></div></td></tr></tbody></table></div>
<p>在上面的test.c中存在四个basic block，我们可以通过命令生成dot文件，然后使用dot工具生成图片。
</p><div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-25-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-25-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-25-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-25-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-25-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-25-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-25-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-25-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-25-10">10</a></span>
<span class="normal"><a href="#__codelineno-25-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="c1"># 安装dot工具</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>graphviz
<a id="__codelineno-25-3" name="__codelineno-25-3"></a>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="c1"># Generate the LLVM IR</span>
<a id="__codelineno-25-5" name="__codelineno-25-5"></a>clang-16<span class="w"> </span>-S<span class="w"> </span>-emit-llvm<span class="w"> </span>test.c<span class="w"> </span>-o<span class="w"> </span>test.ll
<a id="__codelineno-25-6" name="__codelineno-25-6"></a>
<a id="__codelineno-25-7" name="__codelineno-25-7"></a><span class="c1"># Print Control-Flow Graph to 'dot' file.</span>
<a id="__codelineno-25-8" name="__codelineno-25-8"></a>opt-16<span class="w"> </span>-dot-cfg<span class="w"> </span>-disable-output<span class="w"> </span>-enable-new-pm<span class="o">=</span><span class="m">0</span><span class="w"> </span>test.ll
<a id="__codelineno-25-9" name="__codelineno-25-9"></a>
<a id="__codelineno-25-10" name="__codelineno-25-10"></a><span class="c1"># Generate an image from the 'dot' file</span>
<a id="__codelineno-25-11" name="__codelineno-25-11"></a>dot<span class="w"> </span>-Tpng<span class="w"> </span>-o<span class="w"> </span>img.png<span class="w"> </span>.main.dot
</code></pre></div></td></tr></tbody></table></div><p></p>
<p><a href="https://sh4dy.com/2024/07/06/learning_llvm_02/">main函数的CFG图</a>如图所示：</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="https://sh4dy.com/images/llvm_learning/llvm_learning_03.png" data-desc-position="bottom"><img alt="" src="https://sh4dy.com/images/llvm_learning/llvm_learning_03.png"></a></p>
<hr>
<p>这节我们要完成一个什么事情呢？</p>
<p>读取一个 code.txt 文件，分析每一行指令，比如add。每种指令都有生成对应的LLVM IR，通过LLVM JIT编译注册进Module的IR，可以通过指令名称查找到已编译的函数的入口点，调用执行：</p>
<div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1">1</a></span>
<span class="normal"><a href="#__codelineno-26-2">2</a></span>
<span class="normal"><a href="#__codelineno-26-3">3</a></span>
<span class="normal"><a href="#__codelineno-26-4">4</a></span>
<span class="normal"><a href="#__codelineno-26-5">5</a></span>
<span class="normal"><a href="#__codelineno-26-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="n">add</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="n">sub</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="n">mul</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="k">xor</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="n">add</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span>
<a id="__codelineno-26-6" name="__codelineno-26-6"></a><span class="k">xor</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span>
</code></pre></div></td></tr></tbody></table></div>
<h2 id="llvm-jit介绍">LLVM JIT介绍<a class="headerlink" href="#llvm-jit介绍" title="Permanent link">¶</a></h2>
<h3 id="什么是jit">什么是JIT？<a class="headerlink" href="#什么是jit" title="Permanent link">¶</a></h3>
<p>JIT（即时编译器）是一种在程序开始执行后才动态生成机器代码的编译器。与之相对的是AOT（预先编译器），它在程序执行之前将源代码翻译成可执行代码，这些可执行代码存储在编译后的二进制文件中。</p>
<p>具体来说，JIT编译器在运行时对代码进行编译，这意味着它可以在程序执行的过程中优化代码性能，因为它可以利用运行时的信息来进行更有效的优化。这种动态编译的方式允许程序在执行时进行调整，从而提高效率和性能。</p>
<p>相反，AOT编译器在程序运行之前就已经将代码编译好了。这样做的好处是程序启动速度更快，因为可执行代码已经准备就绪。缺点是在编译时不能利用运行时信息来优化代码。</p>
<h3 id="什么是orc">什么是ORC<a class="headerlink" href="#什么是orc" title="Permanent link">¶</a></h3>
<p>ORC（On-Request Compilation，按需编译）是LLVM JIT API的第三代实现。在ORC之前，有MCJIT，再往前则是Legacy JIT。ORC提供了一种更灵活和模块化的方式来进行即时编译。</p>
<p>与之前的JIT实现相比，ORC的设计目标之一是提高编译过程的灵活性和可扩展性。它允许开发者更精细地控制代码生成和优化过程，并支持更复杂的用例。</p>
<p>在使用ORC JIT API时，开发者可以动态地生成机器代码，这对于需要高性能和灵活性的应用来说非常有用。比如在一个小型计算器项目中，ORC可以用来在运行时即时编译和执行用户输入的计算表达式。通过ORC API，开发者可以编写程序，在需要时动态生成和执行高效的机器代码。</p>
<h3 id="llvm中的jit">LLVM中的JIT<a class="headerlink" href="#llvm中的jit" title="Permanent link">¶</a></h3>
<p>LLVM的JIT（即时编译）功能是一种强大的机制，可以在程序运行时动态生成和优化机器代码。这对于需要高性能和灵活性的应用程序非常有用，比如解释器、动态语言运行时或特定场景的优化代码。以下是LLVM JIT的一些关键点和如何使用它的基本步骤：</p>
<ul>
<li>
<p><strong>LLVM IR</strong>：LLVM的中间表示，JIT编译器会将这种中间表示转换为机器代码。LLVM IR是平台无关的，并且易于分析和优化。</p>
</li>
<li>
<p><strong>ExecutionEngine</strong>：这是LLVM提供的用于执行JIT编译代码的核心组件。ExecutionEngine负责将LLVM IR转换为本地机器代码，并在目标平台上执行。</p>
</li>
<li>
<p><strong>MCJIT和ORC</strong>：LLVM中有两种主要的JIT引擎：</p>
</li>
<li><strong>MCJIT</strong>：一种较旧的JIT实现，提供了基本的JIT编译功能。</li>
<li><strong>ORC（On Request Compilation）</strong>：一种更现代和模块化的JIT实现，提供了更灵活和强大的功能，比如更好的代码分离和内存管理。</li>
</ul>
<h3 id="使用llvm-jit的基本步骤">使用LLVM JIT的基本步骤<a class="headerlink" href="#使用llvm-jit的基本步骤" title="Permanent link">¶</a></h3>
<ol>
<li>
<p><strong>创建LLVM模块和IR</strong>：首先，需要构建一个LLVM模块，并使用IR Builder生成LLVM IR。这一步通常涉及定义函数、基本块和指令。</p>
</li>
<li>
<p><strong>初始化JIT引擎</strong>：选择并初始化一个JIT引擎（MCJIT或ORC）。这包括创建ExecutionEngine和配置目标机器。</p>
</li>
<li>
<p><strong>添加模块到引擎</strong>：将LLVM模块添加到JIT引擎中。引擎会负责将模块中的IR转换为机器代码。</p>
</li>
<li>
<p><strong>查找和执行函数</strong>：通过引擎查找已编译的函数的入口点，然后通过函数指针调用它们。</p>
</li>
</ol>
<h2 id="实现一个计算器">实现一个计算器<a class="headerlink" href="#实现一个计算器" title="Permanent link">¶</a></h2>
<h3 id="代码实现">代码实现<a class="headerlink" href="#代码实现" title="Permanent link">¶</a></h3>
<p>定义了add, sub, mul, xor四个指令，从txt文件中读取，每一行都是一个语句。</p>
<p></p><div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1">1</a></span>
<span class="normal"><a href="#__codelineno-27-2">2</a></span>
<span class="normal"><a href="#__codelineno-27-3">3</a></span>
<span class="normal"><a href="#__codelineno-27-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a>add val1, val2  
<a id="__codelineno-27-2" name="__codelineno-27-2"></a>sub val1, val2  
<a id="__codelineno-27-3" name="__codelineno-27-3"></a>mul val1, val2  
<a id="__codelineno-27-4" name="__codelineno-27-4"></a>xor val1, val2  
</code></pre></div></td></tr></tbody></table></div>
定义一个结构体来保存指令信息，<p></p>
<div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1">1</a></span>
<span class="normal"><a href="#__codelineno-28-2">2</a></span>
<span class="normal"><a href="#__codelineno-28-3">3</a></span>
<span class="normal"><a href="#__codelineno-28-4">4</a></span>
<span class="normal"><a href="#__codelineno-28-5">5</a></span>
<span class="normal"><a href="#__codelineno-28-6">6</a></span>
<span class="normal"><a href="#__codelineno-28-7">7</a></span>
<span class="normal"><a href="#__codelineno-28-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Instruction</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w"> </span><span class="c1">// add，sub，mul，xor</span>
<a id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="w">    </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">val1</span><span class="p">;</span>
<a id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="w">    </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">val2</span><span class="p">;</span>
<a id="__codelineno-28-5" name="__codelineno-28-5"></a>
<a id="__codelineno-28-6" name="__codelineno-28-6"></a><span class="w">    </span><span class="n">Instruction</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">val1</span><span class="p">,</span><span class="w"> </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">val2</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-28-7" name="__codelineno-28-7"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">name</span><span class="p">(</span><span class="n">name</span><span class="p">),</span><span class="w"> </span><span class="n">val1</span><span class="p">(</span><span class="n">val1</span><span class="p">),</span><span class="w"> </span><span class="n">val2</span><span class="p">(</span><span class="n">val2</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-28-8" name="__codelineno-28-8"></a><span class="p">};</span>
</code></pre></div></td></tr></tbody></table></div>
<p>从文件读取所有的指令，保存到vector中。
</p><div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-29-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-29-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-29-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-29-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-29-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-29-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-29-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-29-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-29-10">10</a></span>
<span class="normal"><a href="#__codelineno-29-11">11</a></span>
<span class="normal"><a href="#__codelineno-29-12">12</a></span>
<span class="normal"><a href="#__codelineno-29-13">13</a></span>
<span class="normal"><a href="#__codelineno-29-14">14</a></span>
<span class="normal"><a href="#__codelineno-29-15">15</a></span>
<span class="normal"><a href="#__codelineno-29-16">16</a></span>
<span class="normal"><a href="#__codelineno-29-17">17</a></span>
<span class="normal"><a href="#__codelineno-29-18">18</a></span>
<span class="normal"><a href="#__codelineno-29-19">19</a></span>
<span class="normal"><a href="#__codelineno-29-20">20</a></span>
<span class="normal"><a href="#__codelineno-29-21">21</a></span>
<span class="normal"><a href="#__codelineno-29-22">22</a></span>
<span class="normal"><a href="#__codelineno-29-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Instruction</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">GetInstructions</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">file_name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">ifstream</span><span class="w"> </span><span class="nf">ifile</span><span class="p">(</span><span class="n">file_name</span><span class="p">);</span>
<a id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">instruction_line</span><span class="p">;</span>
<a id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Instruction</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">instructions</span><span class="p">;</span>
<a id="__codelineno-29-5" name="__codelineno-29-5"></a>
<a id="__codelineno-29-6" name="__codelineno-29-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">ifile</span><span class="p">.</span><span class="n">is_open</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-7" name="__codelineno-29-7"></a><span class="w">        </span><span class="n">fatal_error</span><span class="p">(</span><span class="s">"Failed to open file: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">file_name</span><span class="p">);</span>
<a id="__codelineno-29-8" name="__codelineno-29-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-29-9" name="__codelineno-29-9"></a>
<a id="__codelineno-29-10" name="__codelineno-29-10"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">getline</span><span class="p">(</span><span class="n">ifile</span><span class="p">,</span><span class="w"> </span><span class="n">instruction_line</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-11" name="__codelineno-29-11"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">istringstream</span><span class="w"> </span><span class="nf">stream</span><span class="p">(</span><span class="n">instruction_line</span><span class="p">);</span>
<a id="__codelineno-29-12" name="__codelineno-29-12"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">instruction_type</span><span class="p">;</span>
<a id="__codelineno-29-13" name="__codelineno-29-13"></a><span class="w">        </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">val1</span><span class="p">,</span><span class="w"> </span><span class="n">val2</span><span class="p">;</span>
<a id="__codelineno-29-14" name="__codelineno-29-14"></a><span class="w">        </span><span class="kt">char</span><span class="w"> </span><span class="n">comma</span><span class="p">;</span>
<a id="__codelineno-29-15" name="__codelineno-29-15"></a>
<a id="__codelineno-29-16" name="__codelineno-29-16"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">stream</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">instruction_type</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">val1</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">comma</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">val2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-17" name="__codelineno-29-17"></a><span class="w">            </span><span class="n">instructions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Instruction</span><span class="o">&gt;</span><span class="p">(</span><span class="n">instruction_type</span><span class="p">,</span><span class="w"> </span><span class="n">val1</span><span class="p">,</span><span class="w"> </span><span class="n">val2</span><span class="p">));</span>
<a id="__codelineno-29-18" name="__codelineno-29-18"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-19" name="__codelineno-29-19"></a><span class="w">            </span><span class="n">fatal_error</span><span class="p">(</span><span class="s">"Invalid instruction format: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">instruction_line</span><span class="p">);</span>
<a id="__codelineno-29-20" name="__codelineno-29-20"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-29-21" name="__codelineno-29-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-29-22" name="__codelineno-29-22"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">instructions</span><span class="p">;</span>
<a id="__codelineno-29-23" name="__codelineno-29-23"></a><span class="p">}</span>
</code></pre></div></td></tr></tbody></table></div><p></p>
<p>现在我们已经覆盖了基础知识，可以开始处理特定于LLVM的任务。在JIT（即时编译）我们的代码之前，我们需要为所有希望JIT编译的函数生成相应的LLVM IR（中间表示）。要生成LLVM IR，首先需要创建一个LLVM上下文、一个LLVM模块和一个IR生成器。</p>
<ul>
<li>
<p>上下文（Context）：上下文是一个容器，用于拥有和管理LLVM特定的核心数据结构。</p>
</li>
<li>
<p>模块（Module）：LLVM模块是一个顶级容器，表示一个编译单元，包含函数、全局变量以及其他程序元素，比如该模块依赖的库（或其他模块）列表、符号表等。</p>
</li>
<li>
<p>基本块（Basic Block）：基本块是一组线性顺序的指令序列，没有分支，意味着执行从一个单一入口点开始，按顺序进行到一个单一出口点，随后继续到下一个基本块。基本块属于函数，不能在中间有跳转，确保一旦开始执行，就会按顺序执行完该块内的所有指令。基本块的第一条指令被称为领导者（leader）。</p>
</li>
</ul>
<p>我们的目标是为每条指令生成一个LLVM IR形式的单独函数。例如，与add指令对应的函数将如下所示：</p>
<div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1">1</a></span>
<span class="normal"><a href="#__codelineno-30-2">2</a></span>
<span class="normal"><a href="#__codelineno-30-3">3</a></span>
<span class="normal"><a href="#__codelineno-30-4">4</a></span>
<span class="normal"><a href="#__codelineno-30-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="n">define</span><span class="w"> </span><span class="n">i64</span><span class="w"> </span><span class="err">@</span><span class="n">add</span><span class="p">(</span><span class="n">i64</span><span class="w"> </span><span class="o">%</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">i64</span><span class="w"> </span><span class="o">%</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="nl">entry</span><span class="p">:</span>
<a id="__codelineno-30-3" name="__codelineno-30-3"></a><span class="w">  </span><span class="o">%</span><span class="mi">2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">i64</span><span class="w"> </span><span class="o">%</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="mi">1</span>
<a id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="w">  </span><span class="n">ret</span><span class="w"> </span><span class="n">i64</span><span class="w"> </span><span class="o">%</span><span class="mi">2</span>
<a id="__codelineno-30-5" name="__codelineno-30-5"></a><span class="p">}</span>
</code></pre></div></td></tr></tbody></table></div>
<p>写一个函数来为add, sun, mul, xor生成LLVM IR，
</p><div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-31-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-31-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-31-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-31-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-31-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-31-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-31-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-31-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-31-10">10</a></span>
<span class="normal"><a href="#__codelineno-31-11">11</a></span>
<span class="normal"><a href="#__codelineno-31-12">12</a></span>
<span class="normal"><a href="#__codelineno-31-13">13</a></span>
<span class="normal"><a href="#__codelineno-31-14">14</a></span>
<span class="normal"><a href="#__codelineno-31-15">15</a></span>
<span class="normal"><a href="#__codelineno-31-16">16</a></span>
<span class="normal"><a href="#__codelineno-31-17">17</a></span>
<span class="normal"><a href="#__codelineno-31-18">18</a></span>
<span class="normal"><a href="#__codelineno-31-19">19</a></span>
<span class="normal"><a href="#__codelineno-31-20">20</a></span>
<span class="normal"><a href="#__codelineno-31-21">21</a></span>
<span class="normal"><a href="#__codelineno-31-22">22</a></span>
<span class="normal"><a href="#__codelineno-31-23">23</a></span>
<span class="normal"><a href="#__codelineno-31-24">24</a></span>
<span class="normal"><a href="#__codelineno-31-25">25</a></span>
<span class="normal"><a href="#__codelineno-31-26">26</a></span>
<span class="normal"><a href="#__codelineno-31-27">27</a></span>
<span class="normal"><a href="#__codelineno-31-28">28</a></span>
<span class="normal"><a href="#__codelineno-31-29">29</a></span>
<span class="normal"><a href="#__codelineno-31-30">30</a></span>
<span class="normal"><a href="#__codelineno-31-31">31</a></span>
<span class="normal"><a href="#__codelineno-31-32">32</a></span>
<span class="normal"><a href="#__codelineno-31-33">33</a></span>
<span class="normal"><a href="#__codelineno-31-34">34</a></span>
<span class="normal"><a href="#__codelineno-31-35">35</a></span>
<span class="normal"><a href="#__codelineno-31-36">36</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">AddFunctionsToIR</span><span class="p">(</span><span class="n">llvm</span><span class="o">::</span><span class="n">LLVMContext</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">llvm</span><span class="o">::</span><span class="n">Module</span><span class="w"> </span><span class="o">*</span><span class="k">module</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">function_name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-31-2" name="__codelineno-31-2"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">int64_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">llvm</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">getInt64Ty</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span>
<a id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">llvm</span><span class="o">::</span><span class="n">Type</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">params</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">int64_type</span><span class="p">);</span>
<a id="__codelineno-31-4" name="__codelineno-31-4"></a><span class="w">    </span><span class="n">llvm</span><span class="o">::</span><span class="n">IRBuilder</span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">ir_builder</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span>
<a id="__codelineno-31-5" name="__codelineno-31-5"></a>
<a id="__codelineno-31-6" name="__codelineno-31-6"></a><span class="w">    </span><span class="n">llvm</span><span class="o">::</span><span class="n">FunctionType</span><span class="w"> </span><span class="o">*</span><span class="n">function_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">llvm</span><span class="o">::</span><span class="n">FunctionType</span><span class="o">::</span><span class="n">get</span><span class="p">(</span><span class="n">int64_type</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<a id="__codelineno-31-7" name="__codelineno-31-7"></a><span class="w">    </span><span class="n">llvm</span><span class="o">::</span><span class="n">Function</span><span class="w"> </span><span class="o">*</span><span class="n">func</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">llvm</span><span class="o">::</span><span class="n">Function</span><span class="o">::</span><span class="n">Create</span><span class="p">(</span><span class="n">function_type</span><span class="p">,</span><span class="w"> </span><span class="n">llvm</span><span class="o">::</span><span class="n">Function</span><span class="o">::</span><span class="n">ExternalLinkage</span><span class="p">,</span><span class="w"> </span><span class="n">function_name</span><span class="p">,</span><span class="w"> </span><span class="k">module</span><span class="p">);</span>
<a id="__codelineno-31-8" name="__codelineno-31-8"></a>
<a id="__codelineno-31-9" name="__codelineno-31-9"></a><span class="w">    </span><span class="c1">// Create the entry block for the function</span>
<a id="__codelineno-31-10" name="__codelineno-31-10"></a><span class="w">    </span><span class="n">llvm</span><span class="o">::</span><span class="n">BasicBlock</span><span class="w"> </span><span class="o">*</span><span class="n">basic_block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">llvm</span><span class="o">::</span><span class="n">BasicBlock</span><span class="o">::</span><span class="n">Create</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="s">"entry"</span><span class="p">,</span><span class="w"> </span><span class="n">func</span><span class="p">);</span>
<a id="__codelineno-31-11" name="__codelineno-31-11"></a>
<a id="__codelineno-31-12" name="__codelineno-31-12"></a><span class="w">    </span><span class="c1">// Append instructions to the basic block</span>
<a id="__codelineno-31-13" name="__codelineno-31-13"></a><span class="w">    </span><span class="n">ir_builder</span><span class="p">.</span><span class="n">SetInsertPoint</span><span class="p">(</span><span class="n">basic_block</span><span class="p">);</span>
<a id="__codelineno-31-14" name="__codelineno-31-14"></a>
<a id="__codelineno-31-15" name="__codelineno-31-15"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">func</span><span class="o">-&gt;</span><span class="n">args</span><span class="p">();</span>
<a id="__codelineno-31-16" name="__codelineno-31-16"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">arg_iter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">args</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
<a id="__codelineno-31-17" name="__codelineno-31-17"></a><span class="w">    </span><span class="n">llvm</span><span class="o">::</span><span class="n">Argument</span><span class="w"> </span><span class="o">*</span><span class="n">arg1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arg_iter</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-31-18" name="__codelineno-31-18"></a><span class="w">    </span><span class="n">llvm</span><span class="o">::</span><span class="n">Argument</span><span class="w"> </span><span class="o">*</span><span class="n">arg2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arg_iter</span><span class="p">;</span>
<a id="__codelineno-31-19" name="__codelineno-31-19"></a>
<a id="__codelineno-31-20" name="__codelineno-31-20"></a><span class="w">    </span><span class="n">llvm</span><span class="o">::</span><span class="n">Value</span><span class="w"> </span><span class="o">*</span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<a id="__codelineno-31-21" name="__codelineno-31-21"></a>
<a id="__codelineno-31-22" name="__codelineno-31-22"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">function_name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"add"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-31-23" name="__codelineno-31-23"></a><span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ir_builder</span><span class="p">.</span><span class="n">CreateAdd</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span><span class="w"> </span><span class="n">arg2</span><span class="p">);</span>
<a id="__codelineno-31-24" name="__codelineno-31-24"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">function_name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"sub"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-31-25" name="__codelineno-31-25"></a><span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ir_builder</span><span class="p">.</span><span class="n">CreateSub</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span><span class="w"> </span><span class="n">arg2</span><span class="p">);</span>
<a id="__codelineno-31-26" name="__codelineno-31-26"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">function_name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"mul"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-31-27" name="__codelineno-31-27"></a><span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ir_builder</span><span class="p">.</span><span class="n">CreateMul</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span><span class="w"> </span><span class="n">arg2</span><span class="p">);</span>
<a id="__codelineno-31-28" name="__codelineno-31-28"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">function_name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"xor"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-31-29" name="__codelineno-31-29"></a><span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ir_builder</span><span class="p">.</span><span class="n">CreateXor</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span><span class="w"> </span><span class="n">arg2</span><span class="p">);</span>
<a id="__codelineno-31-30" name="__codelineno-31-30"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-31-31" name="__codelineno-31-31"></a><span class="w">        </span><span class="n">fatal_error</span><span class="p">(</span><span class="s">"Invalid function name: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">function_name</span><span class="p">);</span>
<a id="__codelineno-31-32" name="__codelineno-31-32"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-31-33" name="__codelineno-31-33"></a>
<a id="__codelineno-31-34" name="__codelineno-31-34"></a><span class="w">    </span><span class="c1">// return the value</span>
<a id="__codelineno-31-35" name="__codelineno-31-35"></a><span class="w">    </span><span class="n">ir_builder</span><span class="p">.</span><span class="n">CreateRet</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
<a id="__codelineno-31-36" name="__codelineno-31-36"></a><span class="p">}</span>
</code></pre></div></td></tr></tbody></table></div>
这段代码为我们的每条指令生成函数。每个函数接受两个参数，并根据操作返回一个值。现在我们已经创建了这个函数，让我们继续编写主函数的代码。<p></p>
<p>调用两个关键的函数进行初始化：
</p><div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-32-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-32-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-32-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-32-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-32-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-32-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-32-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-32-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-32-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="cm">/*</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="cm">Initialize the native target corresponding to the host</span>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="cm">*/</span>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="n">llvm</span><span class="o">::</span><span class="n">InitializeNativeTarget</span><span class="p">();</span>
<a id="__codelineno-32-5" name="__codelineno-32-5"></a>
<a id="__codelineno-32-6" name="__codelineno-32-6"></a>
<a id="__codelineno-32-7" name="__codelineno-32-7"></a><span class="cm">/* Calling this function is also necessary for code generation.</span>
<a id="__codelineno-32-8" name="__codelineno-32-8"></a><span class="cm"> It sets up the assembly printer for the native host architecture.</span>
<a id="__codelineno-32-9" name="__codelineno-32-9"></a><span class="cm">*/</span>
<a id="__codelineno-32-10" name="__codelineno-32-10"></a><span class="n">llvm</span><span class="o">::</span><span class="n">InitializeNativeTargetAsmPrinter</span><span class="p">();</span>
</code></pre></div></td></tr></tbody></table></div><p></p>
<p>创建ctx和module。
</p><div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1">1</a></span>
<span class="normal"><a href="#__codelineno-33-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="n">llvm</span><span class="o">::</span><span class="n">LLVMContext</span><span class="w"> </span><span class="n">ctx</span><span class="p">;</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a><span class="k">auto</span><span class="w"> </span><span class="k">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">llvm</span><span class="o">::</span><span class="n">Module</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"my_module"</span><span class="p">,</span><span class="w"> </span><span class="n">ctx</span><span class="p">);</span>
</code></pre></div></td></tr></tbody></table></div><p></p>
<p>调用上面的AddFunctionsToIR函数，为add, sub, mul, xor生成LLVM IR。</p>
<div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1">1</a></span>
<span class="normal"><a href="#__codelineno-34-2">2</a></span>
<span class="normal"><a href="#__codelineno-34-3">3</a></span>
<span class="normal"><a href="#__codelineno-34-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="n">AddFunctionsToIR</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="k">module</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span><span class="w"> </span><span class="s">"add"</span><span class="p">);</span>
<a id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="n">AddFunctionsToIR</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="k">module</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span><span class="w"> </span><span class="s">"sub"</span><span class="p">);</span>
<a id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="n">AddFunctionsToIR</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="k">module</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span><span class="w"> </span><span class="s">"mul"</span><span class="p">);</span>
<a id="__codelineno-34-4" name="__codelineno-34-4"></a><span class="n">AddFunctionsToIR</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="k">module</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span><span class="w"> </span><span class="s">"xor"</span><span class="p">);</span>
</code></pre></div></td></tr></tbody></table></div>
<p>我们可以创建一个 LLJIT 生成器的实例。LLJIT 是 LLVM 的 ORC（按需编译）JIT 引擎的一部分，它为即时编译提供了一个现代、灵活和模块化的基础设施，是 MCJIT 的合适替代品。</p>
<div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1">1</a></span>
<span class="normal"><a href="#__codelineno-35-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="k">auto</span><span class="w"> </span><span class="n">jit_builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">llvm</span><span class="o">::</span><span class="n">orc</span><span class="o">::</span><span class="n">LLJITBuilder</span><span class="p">();</span>
<a id="__codelineno-35-2" name="__codelineno-35-2"></a><span class="k">auto</span><span class="w"> </span><span class="n">jit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jit_builder</span><span class="p">.</span><span class="n">create</span><span class="p">();</span>
</code></pre></div></td></tr></tbody></table></div>
<p>接下来，就是将我们的模块添加到主JITDylib（一个JITDylib代表了一个JIT的动态库）。</p>
<div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1">1</a></span>
<span class="normal"><a href="#__codelineno-36-2">2</a></span>
<span class="normal"><a href="#__codelineno-36-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jit</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">addIRModule</span><span class="p">(</span><span class="n">llvm</span><span class="o">::</span><span class="n">orc</span><span class="o">::</span><span class="n">ThreadSafeModule</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="k">module</span><span class="p">),</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">llvm</span><span class="o">::</span><span class="n">LLVMContext</span><span class="o">&gt;</span><span class="p">())))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-2" name="__codelineno-36-2"></a><span class="w">    </span><span class="n">fatal_error</span><span class="p">(</span><span class="s">"Failed to add IR module for JIT compilation: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">llvm</span><span class="o">::</span><span class="n">toString</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">err</span><span class="p">)));</span>
<a id="__codelineno-36-3" name="__codelineno-36-3"></a><span class="p">}</span>
</code></pre></div></td></tr></tbody></table></div>
<p></p><div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1">1</a></span>
<span class="normal"><a href="#__codelineno-37-2">2</a></span>
<span class="normal"><a href="#__codelineno-37-3">3</a></span>
<span class="normal"><a href="#__codelineno-37-4">4</a></span>
<span class="normal"><a href="#__codelineno-37-5">5</a></span>
<span class="normal"><a href="#__codelineno-37-6">6</a></span>
<span class="normal"><a href="#__codelineno-37-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="n">llvm</span><span class="o">::</span><span class="n">orc</span><span class="o">::</span><span class="n">ExecutorAddr</span><span class="w"> </span><span class="nf">GetExecutorAddr</span><span class="p">(</span><span class="n">llvm</span><span class="o">::</span><span class="n">orc</span><span class="o">::</span><span class="n">LLJIT</span><span class="w"> </span><span class="o">&amp;</span><span class="n">jit</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">function_name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-2" name="__codelineno-37-2"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">sym</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jit</span><span class="p">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">function_name</span><span class="p">).</span><span class="n">get</span><span class="p">();</span>
<a id="__codelineno-37-3" name="__codelineno-37-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">sym</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-4" name="__codelineno-37-4"></a><span class="w">        </span><span class="n">fatal_error</span><span class="p">(</span><span class="s">"Function not found in JIT: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">function_name</span><span class="p">);</span>
<a id="__codelineno-37-5" name="__codelineno-37-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-37-6" name="__codelineno-37-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">sym</span><span class="p">;</span>
<a id="__codelineno-37-7" name="__codelineno-37-7"></a><span class="p">}</span>
</code></pre></div></td></tr></tbody></table></div>
解析code.txt文件，也就是每一行都是一条指令。根据指令的名称，比如add去获取llvm::orc::ExecutorAddr。通过强制转换拿到fn，执行。
<div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-38-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-38-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-38-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-38-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-38-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-38-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-38-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-38-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-38-10">10</a></span>
<span class="normal"><a href="#__codelineno-38-11">11</a></span>
<span class="normal"><a href="#__codelineno-38-12">12</a></span>
<span class="normal"><a href="#__codelineno-38-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="c1">// main</span>
<a id="__codelineno-38-2" name="__codelineno-38-2"></a><span class="k">auto</span><span class="w"> </span><span class="n">instructions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetInstructions</span><span class="p">(</span><span class="s">"code.txt"</span><span class="p">);</span>
<a id="__codelineno-38-3" name="__codelineno-38-3"></a><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">llvm</span><span class="o">::</span><span class="n">orc</span><span class="o">::</span><span class="n">ExecutorAddr</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fn_symbols</span><span class="p">;</span>
<a id="__codelineno-38-4" name="__codelineno-38-4"></a>
<a id="__codelineno-38-5" name="__codelineno-38-5"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">instruction</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">instructions</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-6" name="__codelineno-38-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fn_symbols</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">instruction</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">fn_symbols</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-7" name="__codelineno-38-7"></a><span class="w">        </span><span class="n">fn_symbols</span><span class="p">[</span><span class="n">instruction</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetExecutorAddr</span><span class="p">(</span><span class="o">*</span><span class="n">jit</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(),</span><span class="w"> </span><span class="n">instruction</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-38-8" name="__codelineno-38-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-38-9" name="__codelineno-38-9"></a>
<a id="__codelineno-38-10" name="__codelineno-38-10"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="o">*</span><span class="n">fn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">int64_t</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="kt">int64_t</span><span class="p">,</span><span class="w"> </span><span class="kt">int64_t</span><span class="p">)</span><span class="o">&gt;</span><span class="p">(</span><span class="n">fn_symbols</span><span class="p">[</span><span class="n">instruction</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">].</span><span class="n">getValue</span><span class="p">());</span>
<a id="__codelineno-38-11" name="__codelineno-38-11"></a><span class="w">    </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fn</span><span class="p">(</span><span class="n">instruction</span><span class="o">-&gt;</span><span class="n">val1</span><span class="p">,</span><span class="w"> </span><span class="n">instruction</span><span class="o">-&gt;</span><span class="n">val2</span><span class="p">);</span>
<a id="__codelineno-38-12" name="__codelineno-38-12"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-38-13" name="__codelineno-38-13"></a><span class="p">}</span>
</code></pre></div></td></tr></tbody></table></div><p></p>
<p>为了避免多次获取函数地址，我们可以将函数地址存储在一个哈希表中。这样，每次需要执行指令时，我们都可以直接从哈希表中获取函数地址，而不需要每次都通过 JIT 查找。</p>
<div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">llvm</span><span class="o">::</span><span class="n">orc</span><span class="o">::</span><span class="n">ExecutorAddr</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fn_symbols</span><span class="p">;</span>
</code></pre></div></td></tr></tbody></table></div>
<p>完整的代码如下：</p>
<div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1">  1</a></span>
<span class="normal"><a href="#__codelineno-40-2">  2</a></span>
<span class="normal"><a href="#__codelineno-40-3">  3</a></span>
<span class="normal"><a href="#__codelineno-40-4">  4</a></span>
<span class="normal"><a href="#__codelineno-40-5">  5</a></span>
<span class="normal"><a href="#__codelineno-40-6">  6</a></span>
<span class="normal"><a href="#__codelineno-40-7">  7</a></span>
<span class="normal"><a href="#__codelineno-40-8">  8</a></span>
<span class="normal"><a href="#__codelineno-40-9">  9</a></span>
<span class="normal"><a href="#__codelineno-40-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-40-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-40-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-40-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-40-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-40-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-40-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-40-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-40-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-40-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-40-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-40-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-40-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-40-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-40-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-40-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-40-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-40-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-40-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-40-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-40-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-40-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-40-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-40-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-40-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-40-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-40-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-40-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-40-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-40-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-40-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-40-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-40-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-40-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-40-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-40-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-40-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-40-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-40-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-40-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-40-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-40-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-40-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-40-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-40-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-40-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-40-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-40-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-40-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-40-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-40-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-40-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-40-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-40-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-40-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-40-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-40-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-40-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-40-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-40-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-40-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-40-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-40-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-40-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-40-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-40-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-40-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-40-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-40-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-40-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-40-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-40-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-40-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-40-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-40-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-40-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-40-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-40-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-40-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-40-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-40-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-40-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-40-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-40-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-40-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-40-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-40-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-40-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-40-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-40-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-40-100">100</a></span>
<span class="normal"><a href="#__codelineno-40-101">101</a></span>
<span class="normal"><a href="#__codelineno-40-102">102</a></span>
<span class="normal"><a href="#__codelineno-40-103">103</a></span>
<span class="normal"><a href="#__codelineno-40-104">104</a></span>
<span class="normal"><a href="#__codelineno-40-105">105</a></span>
<span class="normal"><a href="#__codelineno-40-106">106</a></span>
<span class="normal"><a href="#__codelineno-40-107">107</a></span>
<span class="normal"><a href="#__codelineno-40-108">108</a></span>
<span class="normal"><a href="#__codelineno-40-109">109</a></span>
<span class="normal"><a href="#__codelineno-40-110">110</a></span>
<span class="normal"><a href="#__codelineno-40-111">111</a></span>
<span class="normal"><a href="#__codelineno-40-112">112</a></span>
<span class="normal"><a href="#__codelineno-40-113">113</a></span>
<span class="normal"><a href="#__codelineno-40-114">114</a></span>
<span class="normal"><a href="#__codelineno-40-115">115</a></span>
<span class="normal"><a href="#__codelineno-40-116">116</a></span>
<span class="normal"><a href="#__codelineno-40-117">117</a></span>
<span class="normal"><a href="#__codelineno-40-118">118</a></span>
<span class="normal"><a href="#__codelineno-40-119">119</a></span>
<span class="normal"><a href="#__codelineno-40-120">120</a></span>
<span class="normal"><a href="#__codelineno-40-121">121</a></span>
<span class="normal"><a href="#__codelineno-40-122">122</a></span>
<span class="normal"><a href="#__codelineno-40-123">123</a></span>
<span class="normal"><a href="#__codelineno-40-124">124</a></span>
<span class="normal"><a href="#__codelineno-40-125">125</a></span>
<span class="normal"><a href="#__codelineno-40-126">126</a></span>
<span class="normal"><a href="#__codelineno-40-127">127</a></span>
<span class="normal"><a href="#__codelineno-40-128">128</a></span>
<span class="normal"><a href="#__codelineno-40-129">129</a></span>
<span class="normal"><a href="#__codelineno-40-130">130</a></span>
<span class="normal"><a href="#__codelineno-40-131">131</a></span>
<span class="normal"><a href="#__codelineno-40-132">132</a></span>
<span class="normal"><a href="#__codelineno-40-133">133</a></span>
<span class="normal"><a href="#__codelineno-40-134">134</a></span>
<span class="normal"><a href="#__codelineno-40-135">135</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-40-2" name="__codelineno-40-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<a id="__codelineno-40-3" name="__codelineno-40-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;fstream&gt;</span>
<a id="__codelineno-40-4" name="__codelineno-40-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sstream&gt;</span>
<a id="__codelineno-40-5" name="__codelineno-40-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unordered_map&gt;</span>
<a id="__codelineno-40-6" name="__codelineno-40-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a id="__codelineno-40-7" name="__codelineno-40-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>
<a id="__codelineno-40-8" name="__codelineno-40-8"></a>
<a id="__codelineno-40-9" name="__codelineno-40-9"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;llvm/IR/LLVMContext.h&gt;</span>
<a id="__codelineno-40-10" name="__codelineno-40-10"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;llvm/IR/Function.h&gt;</span>
<a id="__codelineno-40-11" name="__codelineno-40-11"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;llvm/IR/Module.h&gt;</span>
<a id="__codelineno-40-12" name="__codelineno-40-12"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;llvm/IR/IRBuilder.h&gt;</span>
<a id="__codelineno-40-13" name="__codelineno-40-13"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;llvm/Support/TargetSelect.h&gt;</span>
<a id="__codelineno-40-14" name="__codelineno-40-14"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;llvm/ExecutionEngine/Orc/LLJIT.h&gt;</span>
<a id="__codelineno-40-15" name="__codelineno-40-15"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;llvm/Support/Error.h&gt;</span>
<a id="__codelineno-40-16" name="__codelineno-40-16"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;llvm/Support/raw_ostream.h&gt;</span>
<a id="__codelineno-40-17" name="__codelineno-40-17"></a>
<a id="__codelineno-40-18" name="__codelineno-40-18"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Instruction</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-19" name="__codelineno-40-19"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<a id="__codelineno-40-20" name="__codelineno-40-20"></a><span class="w">    </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">val1</span><span class="p">;</span>
<a id="__codelineno-40-21" name="__codelineno-40-21"></a><span class="w">    </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">val2</span><span class="p">;</span>
<a id="__codelineno-40-22" name="__codelineno-40-22"></a>
<a id="__codelineno-40-23" name="__codelineno-40-23"></a><span class="w">    </span><span class="n">Instruction</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">val1</span><span class="p">,</span><span class="w"> </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">val2</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-40-24" name="__codelineno-40-24"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">name</span><span class="p">(</span><span class="n">name</span><span class="p">),</span><span class="w"> </span><span class="n">val1</span><span class="p">(</span><span class="n">val1</span><span class="p">),</span><span class="w"> </span><span class="n">val2</span><span class="p">(</span><span class="n">val2</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-40-25" name="__codelineno-40-25"></a><span class="p">};</span>
<a id="__codelineno-40-26" name="__codelineno-40-26"></a>
<a id="__codelineno-40-27" name="__codelineno-40-27"></a><span class="kt">void</span><span class="w"> </span><span class="nf">fatal_error</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-28" name="__codelineno-40-28"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-40-29" name="__codelineno-40-29"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-40-30" name="__codelineno-40-30"></a><span class="p">}</span>
<a id="__codelineno-40-31" name="__codelineno-40-31"></a>
<a id="__codelineno-40-32" name="__codelineno-40-32"></a><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Instruction</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">GetInstructions</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">file_name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-33" name="__codelineno-40-33"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">ifstream</span><span class="w"> </span><span class="nf">ifile</span><span class="p">(</span><span class="n">file_name</span><span class="p">);</span>
<a id="__codelineno-40-34" name="__codelineno-40-34"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">instruction_line</span><span class="p">;</span>
<a id="__codelineno-40-35" name="__codelineno-40-35"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Instruction</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">instructions</span><span class="p">;</span>
<a id="__codelineno-40-36" name="__codelineno-40-36"></a>
<a id="__codelineno-40-37" name="__codelineno-40-37"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">ifile</span><span class="p">.</span><span class="n">is_open</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-38" name="__codelineno-40-38"></a><span class="w">        </span><span class="n">fatal_error</span><span class="p">(</span><span class="s">"Failed to open file: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">file_name</span><span class="p">);</span>
<a id="__codelineno-40-39" name="__codelineno-40-39"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-40-40" name="__codelineno-40-40"></a>
<a id="__codelineno-40-41" name="__codelineno-40-41"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">getline</span><span class="p">(</span><span class="n">ifile</span><span class="p">,</span><span class="w"> </span><span class="n">instruction_line</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-42" name="__codelineno-40-42"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">istringstream</span><span class="w"> </span><span class="nf">stream</span><span class="p">(</span><span class="n">instruction_line</span><span class="p">);</span>
<a id="__codelineno-40-43" name="__codelineno-40-43"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">instruction_type</span><span class="p">;</span>
<a id="__codelineno-40-44" name="__codelineno-40-44"></a><span class="w">        </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">val1</span><span class="p">,</span><span class="w"> </span><span class="n">val2</span><span class="p">;</span>
<a id="__codelineno-40-45" name="__codelineno-40-45"></a><span class="w">        </span><span class="kt">char</span><span class="w"> </span><span class="n">comma</span><span class="p">;</span>
<a id="__codelineno-40-46" name="__codelineno-40-46"></a>
<a id="__codelineno-40-47" name="__codelineno-40-47"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">stream</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">instruction_type</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">val1</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">comma</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">val2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-48" name="__codelineno-40-48"></a><span class="w">            </span><span class="n">instructions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Instruction</span><span class="o">&gt;</span><span class="p">(</span><span class="n">instruction_type</span><span class="p">,</span><span class="w"> </span><span class="n">val1</span><span class="p">,</span><span class="w"> </span><span class="n">val2</span><span class="p">));</span>
<a id="__codelineno-40-49" name="__codelineno-40-49"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-50" name="__codelineno-40-50"></a><span class="w">            </span><span class="n">fatal_error</span><span class="p">(</span><span class="s">"Invalid instruction format: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">instruction_line</span><span class="p">);</span>
<a id="__codelineno-40-51" name="__codelineno-40-51"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-40-52" name="__codelineno-40-52"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-40-53" name="__codelineno-40-53"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">instructions</span><span class="p">;</span>
<a id="__codelineno-40-54" name="__codelineno-40-54"></a><span class="p">}</span>
<a id="__codelineno-40-55" name="__codelineno-40-55"></a>
<a id="__codelineno-40-56" name="__codelineno-40-56"></a><span class="kt">void</span><span class="w"> </span><span class="n">AddFunctionsToIR</span><span class="p">(</span><span class="n">llvm</span><span class="o">::</span><span class="n">LLVMContext</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">llvm</span><span class="o">::</span><span class="n">Module</span><span class="w"> </span><span class="o">*</span><span class="k">module</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">function_name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-57" name="__codelineno-40-57"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">int64_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">llvm</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">getInt64Ty</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span>
<a id="__codelineno-40-58" name="__codelineno-40-58"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">llvm</span><span class="o">::</span><span class="n">Type</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">params</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">int64_type</span><span class="p">);</span>
<a id="__codelineno-40-59" name="__codelineno-40-59"></a><span class="w">    </span><span class="n">llvm</span><span class="o">::</span><span class="n">IRBuilder</span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">ir_builder</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span>
<a id="__codelineno-40-60" name="__codelineno-40-60"></a>
<a id="__codelineno-40-61" name="__codelineno-40-61"></a><span class="w">    </span><span class="n">llvm</span><span class="o">::</span><span class="n">FunctionType</span><span class="w"> </span><span class="o">*</span><span class="n">function_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">llvm</span><span class="o">::</span><span class="n">FunctionType</span><span class="o">::</span><span class="n">get</span><span class="p">(</span><span class="n">int64_type</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<a id="__codelineno-40-62" name="__codelineno-40-62"></a><span class="w">    </span><span class="n">llvm</span><span class="o">::</span><span class="n">Function</span><span class="w"> </span><span class="o">*</span><span class="n">func</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">llvm</span><span class="o">::</span><span class="n">Function</span><span class="o">::</span><span class="n">Create</span><span class="p">(</span><span class="n">function_type</span><span class="p">,</span><span class="w"> </span><span class="n">llvm</span><span class="o">::</span><span class="n">Function</span><span class="o">::</span><span class="n">ExternalLinkage</span><span class="p">,</span><span class="w"> </span><span class="n">function_name</span><span class="p">,</span><span class="w"> </span><span class="k">module</span><span class="p">);</span>
<a id="__codelineno-40-63" name="__codelineno-40-63"></a>
<a id="__codelineno-40-64" name="__codelineno-40-64"></a><span class="w">    </span><span class="n">llvm</span><span class="o">::</span><span class="n">BasicBlock</span><span class="w"> </span><span class="o">*</span><span class="n">basic_block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">llvm</span><span class="o">::</span><span class="n">BasicBlock</span><span class="o">::</span><span class="n">Create</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="s">"entry"</span><span class="p">,</span><span class="w"> </span><span class="n">func</span><span class="p">);</span>
<a id="__codelineno-40-65" name="__codelineno-40-65"></a>
<a id="__codelineno-40-66" name="__codelineno-40-66"></a><span class="w">    </span><span class="c1">// Append instructions to the basic block</span>
<a id="__codelineno-40-67" name="__codelineno-40-67"></a><span class="w">    </span><span class="n">ir_builder</span><span class="p">.</span><span class="n">SetInsertPoint</span><span class="p">(</span><span class="n">basic_block</span><span class="p">);</span>
<a id="__codelineno-40-68" name="__codelineno-40-68"></a>
<a id="__codelineno-40-69" name="__codelineno-40-69"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">func</span><span class="o">-&gt;</span><span class="n">args</span><span class="p">();</span>
<a id="__codelineno-40-70" name="__codelineno-40-70"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">arg_iter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">args</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
<a id="__codelineno-40-71" name="__codelineno-40-71"></a><span class="w">    </span><span class="n">llvm</span><span class="o">::</span><span class="n">Argument</span><span class="w"> </span><span class="o">*</span><span class="n">arg1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arg_iter</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-40-72" name="__codelineno-40-72"></a><span class="w">    </span><span class="n">llvm</span><span class="o">::</span><span class="n">Argument</span><span class="w"> </span><span class="o">*</span><span class="n">arg2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arg_iter</span><span class="p">;</span>
<a id="__codelineno-40-73" name="__codelineno-40-73"></a>
<a id="__codelineno-40-74" name="__codelineno-40-74"></a><span class="w">    </span><span class="n">llvm</span><span class="o">::</span><span class="n">Value</span><span class="w"> </span><span class="o">*</span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<a id="__codelineno-40-75" name="__codelineno-40-75"></a>
<a id="__codelineno-40-76" name="__codelineno-40-76"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">function_name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"add"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-77" name="__codelineno-40-77"></a><span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ir_builder</span><span class="p">.</span><span class="n">CreateAdd</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span><span class="w"> </span><span class="n">arg2</span><span class="p">);</span>
<a id="__codelineno-40-78" name="__codelineno-40-78"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">function_name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"sub"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-79" name="__codelineno-40-79"></a><span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ir_builder</span><span class="p">.</span><span class="n">CreateSub</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span><span class="w"> </span><span class="n">arg2</span><span class="p">);</span>
<a id="__codelineno-40-80" name="__codelineno-40-80"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">function_name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"mul"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-81" name="__codelineno-40-81"></a><span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ir_builder</span><span class="p">.</span><span class="n">CreateMul</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span><span class="w"> </span><span class="n">arg2</span><span class="p">);</span>
<a id="__codelineno-40-82" name="__codelineno-40-82"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">function_name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"xor"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-83" name="__codelineno-40-83"></a><span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ir_builder</span><span class="p">.</span><span class="n">CreateXor</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span><span class="w"> </span><span class="n">arg2</span><span class="p">);</span>
<a id="__codelineno-40-84" name="__codelineno-40-84"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-85" name="__codelineno-40-85"></a><span class="w">        </span><span class="n">fatal_error</span><span class="p">(</span><span class="s">"Invalid function name: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">function_name</span><span class="p">);</span>
<a id="__codelineno-40-86" name="__codelineno-40-86"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-40-87" name="__codelineno-40-87"></a>
<a id="__codelineno-40-88" name="__codelineno-40-88"></a><span class="w">    </span><span class="n">ir_builder</span><span class="p">.</span><span class="n">CreateRet</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
<a id="__codelineno-40-89" name="__codelineno-40-89"></a><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-40-90" name="__codelineno-40-90"></a>
<a id="__codelineno-40-91" name="__codelineno-40-91"></a><span class="n">llvm</span><span class="o">::</span><span class="n">orc</span><span class="o">::</span><span class="n">ExecutorAddr</span><span class="w"> </span><span class="n">GetExecutorAddr</span><span class="p">(</span><span class="n">llvm</span><span class="o">::</span><span class="n">orc</span><span class="o">::</span><span class="n">LLJIT</span><span class="w"> </span><span class="o">&amp;</span><span class="n">jit</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">function_name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-92" name="__codelineno-40-92"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">sym</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jit</span><span class="p">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">function_name</span><span class="p">).</span><span class="n">get</span><span class="p">();</span>
<a id="__codelineno-40-93" name="__codelineno-40-93"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">sym</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-94" name="__codelineno-40-94"></a><span class="w">        </span><span class="n">fatal_error</span><span class="p">(</span><span class="s">"Function not found in JIT: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">function_name</span><span class="p">);</span>
<a id="__codelineno-40-95" name="__codelineno-40-95"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-40-96" name="__codelineno-40-96"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">sym</span><span class="p">;</span>
<a id="__codelineno-40-97" name="__codelineno-40-97"></a><span class="p">}</span>
<a id="__codelineno-40-98" name="__codelineno-40-98"></a>
<a id="__codelineno-40-99" name="__codelineno-40-99"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-100" name="__codelineno-40-100"></a><span class="w">    </span><span class="n">llvm</span><span class="o">::</span><span class="n">LLVMContext</span><span class="w"> </span><span class="n">ctx</span><span class="p">;</span>
<a id="__codelineno-40-101" name="__codelineno-40-101"></a><span class="w">    </span><span class="n">llvm</span><span class="o">::</span><span class="n">InitializeNativeTarget</span><span class="p">();</span>
<a id="__codelineno-40-102" name="__codelineno-40-102"></a><span class="w">    </span><span class="n">llvm</span><span class="o">::</span><span class="n">InitializeNativeTargetAsmPrinter</span><span class="p">();</span>
<a id="__codelineno-40-103" name="__codelineno-40-103"></a>
<a id="__codelineno-40-104" name="__codelineno-40-104"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="k">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">llvm</span><span class="o">::</span><span class="n">Module</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"neko_module"</span><span class="p">,</span><span class="w"> </span><span class="n">ctx</span><span class="p">);</span>
<a id="__codelineno-40-105" name="__codelineno-40-105"></a>
<a id="__codelineno-40-106" name="__codelineno-40-106"></a><span class="w">    </span><span class="n">AddFunctionsToIR</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="k">module</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span><span class="w"> </span><span class="s">"add"</span><span class="p">);</span>
<a id="__codelineno-40-107" name="__codelineno-40-107"></a><span class="w">    </span><span class="n">AddFunctionsToIR</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="k">module</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span><span class="w"> </span><span class="s">"sub"</span><span class="p">);</span>
<a id="__codelineno-40-108" name="__codelineno-40-108"></a><span class="w">    </span><span class="n">AddFunctionsToIR</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="k">module</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span><span class="w"> </span><span class="s">"mul"</span><span class="p">);</span>
<a id="__codelineno-40-109" name="__codelineno-40-109"></a><span class="w">    </span><span class="n">AddFunctionsToIR</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="k">module</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span><span class="w"> </span><span class="s">"xor"</span><span class="p">);</span>
<a id="__codelineno-40-110" name="__codelineno-40-110"></a>
<a id="__codelineno-40-111" name="__codelineno-40-111"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">jit_builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">llvm</span><span class="o">::</span><span class="n">orc</span><span class="o">::</span><span class="n">LLJITBuilder</span><span class="p">();</span>
<a id="__codelineno-40-112" name="__codelineno-40-112"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">jit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jit_builder</span><span class="p">.</span><span class="n">create</span><span class="p">();</span>
<a id="__codelineno-40-113" name="__codelineno-40-113"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">jit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-114" name="__codelineno-40-114"></a><span class="w">        </span><span class="n">fatal_error</span><span class="p">(</span><span class="s">"Failed to create JIT: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">llvm</span><span class="o">::</span><span class="n">toString</span><span class="p">(</span><span class="n">jit</span><span class="p">.</span><span class="n">takeError</span><span class="p">()));</span>
<a id="__codelineno-40-115" name="__codelineno-40-115"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-40-116" name="__codelineno-40-116"></a>
<a id="__codelineno-40-117" name="__codelineno-40-117"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jit</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">addIRModule</span><span class="p">(</span><span class="n">llvm</span><span class="o">::</span><span class="n">orc</span><span class="o">::</span><span class="n">ThreadSafeModule</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="k">module</span><span class="p">),</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">llvm</span><span class="o">::</span><span class="n">LLVMContext</span><span class="o">&gt;</span><span class="p">())))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-118" name="__codelineno-40-118"></a><span class="w">        </span><span class="n">fatal_error</span><span class="p">(</span><span class="s">"Failed to add IR module for JIT compilation: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">llvm</span><span class="o">::</span><span class="n">toString</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">err</span><span class="p">)));</span>
<a id="__codelineno-40-119" name="__codelineno-40-119"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-40-120" name="__codelineno-40-120"></a>
<a id="__codelineno-40-121" name="__codelineno-40-121"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">instructions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetInstructions</span><span class="p">(</span><span class="s">"code.txt"</span><span class="p">);</span>
<a id="__codelineno-40-122" name="__codelineno-40-122"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">llvm</span><span class="o">::</span><span class="n">orc</span><span class="o">::</span><span class="n">ExecutorAddr</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fn_symbols</span><span class="p">;</span>
<a id="__codelineno-40-123" name="__codelineno-40-123"></a>
<a id="__codelineno-40-124" name="__codelineno-40-124"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">instruction</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">instructions</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-125" name="__codelineno-40-125"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fn_symbols</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">instruction</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">fn_symbols</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-126" name="__codelineno-40-126"></a><span class="w">            </span><span class="n">fn_symbols</span><span class="p">[</span><span class="n">instruction</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetExecutorAddr</span><span class="p">(</span><span class="o">*</span><span class="n">jit</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(),</span><span class="w"> </span><span class="n">instruction</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-40-127" name="__codelineno-40-127"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-40-128" name="__codelineno-40-128"></a>
<a id="__codelineno-40-129" name="__codelineno-40-129"></a><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="o">*</span><span class="n">fn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">int64_t</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="kt">int64_t</span><span class="p">,</span><span class="w"> </span><span class="kt">int64_t</span><span class="p">)</span><span class="o">&gt;</span><span class="p">(</span><span class="n">fn_symbols</span><span class="p">[</span><span class="n">instruction</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">].</span><span class="n">getValue</span><span class="p">());</span>
<a id="__codelineno-40-130" name="__codelineno-40-130"></a><span class="w">        </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fn</span><span class="p">(</span><span class="n">instruction</span><span class="o">-&gt;</span><span class="n">val1</span><span class="p">,</span><span class="w"> </span><span class="n">instruction</span><span class="o">-&gt;</span><span class="n">val2</span><span class="p">);</span>
<a id="__codelineno-40-131" name="__codelineno-40-131"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-40-132" name="__codelineno-40-132"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-40-133" name="__codelineno-40-133"></a>
<a id="__codelineno-40-134" name="__codelineno-40-134"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-40-135" name="__codelineno-40-135"></a><span class="p">}</span>
</code></pre></div></td></tr></tbody></table></div>
<p>我们可以使用cmake来编译程序, CMakeLists.txt内容如下：
</p><div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-41-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-41-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-41-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-41-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-41-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-41-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-41-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-41-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-41-10">10</a></span>
<span class="normal"><a href="#__codelineno-41-11">11</a></span>
<span class="normal"><a href="#__codelineno-41-12">12</a></span>
<span class="normal"><a href="#__codelineno-41-13">13</a></span>
<span class="normal"><a href="#__codelineno-41-14">14</a></span>
<span class="normal"><a href="#__codelineno-41-15">15</a></span>
<span class="normal"><a href="#__codelineno-41-16">16</a></span>
<span class="normal"><a href="#__codelineno-41-17">17</a></span>
<span class="normal"><a href="#__codelineno-41-18">18</a></span>
<span class="normal"><a href="#__codelineno-41-19">19</a></span>
<span class="normal"><a href="#__codelineno-41-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="n">cmake_minimum_required</span><span class="p">(</span><span class="n">VERSION</span><span class="w"> </span><span class="mf">3.13</span><span class="p">)</span>
<a id="__codelineno-41-2" name="__codelineno-41-2"></a><span class="n">project</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
<a id="__codelineno-41-3" name="__codelineno-41-3"></a>
<a id="__codelineno-41-4" name="__codelineno-41-4"></a><span class="n">set</span><span class="p">(</span><span class="n">CMAKE_CXX_STANDARD_REQUIRED</span><span class="w"> </span><span class="n">ON</span><span class="p">)</span>
<a id="__codelineno-41-5" name="__codelineno-41-5"></a>
<a id="__codelineno-41-6" name="__codelineno-41-6"></a><span class="n">find_package</span><span class="p">(</span><span class="n">LLVM</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="n">REQUIRED</span><span class="w"> </span><span class="n">CONFIG</span><span class="p">)</span>
<a id="__codelineno-41-7" name="__codelineno-41-7"></a>
<a id="__codelineno-41-8" name="__codelineno-41-8"></a><span class="n">add_definitions</span><span class="p">(</span><span class="n">$</span><span class="p">{</span><span class="n">LLVM_DEFINITIONS</span><span class="p">})</span>
<a id="__codelineno-41-9" name="__codelineno-41-9"></a><span class="n">include_directories</span><span class="p">(</span><span class="n">$</span><span class="p">{</span><span class="n">LLVM_INCLUDE_DIRS</span><span class="p">})</span>
<a id="__codelineno-41-10" name="__codelineno-41-10"></a>
<a id="__codelineno-41-11" name="__codelineno-41-11"></a><span class="n">add_executable</span><span class="p">(</span><span class="n">$</span><span class="p">{</span><span class="n">PROJECT_NAME</span><span class="p">}</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">cpp</span><span class="p">)</span>
<a id="__codelineno-41-12" name="__codelineno-41-12"></a>
<a id="__codelineno-41-13" name="__codelineno-41-13"></a><span class="n">llvm_map_components_to_libnames</span><span class="p">(</span>
<a id="__codelineno-41-14" name="__codelineno-41-14"></a><span class="w">    </span><span class="n">llvm_libs</span>
<a id="__codelineno-41-15" name="__codelineno-41-15"></a><span class="w">    </span><span class="n">core</span>
<a id="__codelineno-41-16" name="__codelineno-41-16"></a><span class="w">    </span><span class="n">orcjit</span>
<a id="__codelineno-41-17" name="__codelineno-41-17"></a><span class="w">    </span><span class="n">native</span>
<a id="__codelineno-41-18" name="__codelineno-41-18"></a><span class="p">)</span>
<a id="__codelineno-41-19" name="__codelineno-41-19"></a>
<a id="__codelineno-41-20" name="__codelineno-41-20"></a><span class="n">target_link_libraries</span><span class="p">(</span><span class="n">$</span><span class="p">{</span><span class="n">PROJECT_NAME</span><span class="p">}</span><span class="w"> </span><span class="n">$</span><span class="p">{</span><span class="n">llvm_libs</span><span class="p">})</span>
</code></pre></div></td></tr></tbody></table></div><p></p>
<div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1">1</a></span>
<span class="normal"><a href="#__codelineno-42-2">2</a></span>
<span class="normal"><a href="#__codelineno-42-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a>cmake<span class="w"> </span>-B<span class="w"> </span>build<span class="w"> </span>-S<span class="w"> </span>.
<a id="__codelineno-42-2" name="__codelineno-42-2"></a>
<a id="__codelineno-42-3" name="__codelineno-42-3"></a>cmake<span class="w"> </span>--build<span class="w"> </span>build
</code></pre></div></td></tr></tbody></table></div>
<p>创建一个code.txt文件用来测试：
</p><div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1">1</a></span>
<span class="normal"><a href="#__codelineno-43-2">2</a></span>
<span class="normal"><a href="#__codelineno-43-3">3</a></span>
<span class="normal"><a href="#__codelineno-43-4">4</a></span>
<span class="normal"><a href="#__codelineno-43-5">5</a></span>
<span class="normal"><a href="#__codelineno-43-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="n">add</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span>
<a id="__codelineno-43-2" name="__codelineno-43-2"></a><span class="n">sub</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span>
<a id="__codelineno-43-3" name="__codelineno-43-3"></a><span class="n">mul</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span>
<a id="__codelineno-43-4" name="__codelineno-43-4"></a><span class="k">xor</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span>
<a id="__codelineno-43-5" name="__codelineno-43-5"></a><span class="n">add</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span>
<a id="__codelineno-43-6" name="__codelineno-43-6"></a><span class="k">xor</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span>
</code></pre></div></td></tr></tbody></table></div>
运行结果：
<div class="highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1">1</a></span>
<span class="normal"><a href="#__codelineno-44-2">2</a></span>
<span class="normal"><a href="#__codelineno-44-3">3</a></span>
<span class="normal"><a href="#__codelineno-44-4">4</a></span>
<span class="normal"><a href="#__codelineno-44-5">5</a></span>
<span class="normal"><a href="#__codelineno-44-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="m">3</span>
<a id="__codelineno-44-2" name="__codelineno-44-2"></a><span class="m">5</span>
<a id="__codelineno-44-3" name="__codelineno-44-3"></a><span class="m">200</span>
<a id="__codelineno-44-4" name="__codelineno-44-4"></a><span class="m">0</span>
<a id="__codelineno-44-5" name="__codelineno-44-5"></a><span class="m">15</span>
<a id="__codelineno-44-6" name="__codelineno-44-6"></a><span class="m">15</span>
</code></pre></div></td></tr></tbody></table></div><p></p>
<p>那些经过即时编译（JIT）的函数的代码。这些代码存储在一个区域中，一旦即时编译器将代码写入该区域，该区域的权限随后会被设置为可读可执行。</p>
<h2 id="参考_1">参考<a class="headerlink" href="#参考_1" title="Permanent link">¶</a></h2>
<ul>
<li>
<p>https://sh4dy.com/2024/11/24/learning_llvm_03/</p>
</li>
<li>
<p>https://llvm.org/docs/ORCv2.html</p>
</li>
<li>
<p>https://liuyehcf.github.io/2023/07/10/LLVM-JIT/</p>
</li>
</ul>
<style>
.related-posts {
  margin-top: 1.5rem;
  padding-top: 0.75rem;
  border-top: 1px solid rgba(0,0,0,0.1);
  max-height: none !important; /* 防止Safari错误计算高度 */
  overflow: visible !important; /* 防止内容被截断 */
}
.related-posts h3 {
  margin-top: 0;
  margin-bottom: 0.5rem;
  font-size: 1.2rem;
  font-weight: 500;
  line-height: 1.3;
}
.related-posts ul {
  margin: 0 0 0.5rem 0 !important; /* 强制覆盖可能的冲突样式 */
  padding-left: 1.5rem;
  list-style-position: outside;
}
.related-posts li {
  margin-bottom: 0.25rem;
  line-height: 1.4;
}
/* 暗色模式适配 */
[data-md-color-scheme="slate"] .related-posts {
  border-top-color: rgba(255,255,255,0.1);
}
/* Safari特定修复 */
@supports (-webkit-hyphens:none) {
  .related-posts {
    display: block;
    position: relative;
    height: auto !important;
  }
  .related-posts ul {
    position: static;
  }
}
</style>
<div class="related-posts">
<h3>📚 相关文章推荐</h3>
<ul>
<li><a href="https://kenforever1.github.io/blog/netcap调试/" target="_blank">netcap调试</a></li>
<li><a href="https://kenforever1.github.io/blog/从deepseek开源库3fs中学习fuse的使用-如何开发一个文件系统一/" target="_blank">从Deepseek开源库3FS中学习fuse的使用-如何开发一个文件系统（一）</a></li>
<li><a href="https://kenforever1.github.io/blog/brpc中的profile实现/" target="_blank">brpc中的profile实现</a></li>
<li><a href="https://kenforever1.github.io/blog/helix-gpt如何实现ai-code以及如何调试/" target="_blank">helix-gpt如何实现AI code以及如何调试?</a></li>
<li><a href="https://kenforever1.github.io/blog/使用aya和c混合编写uprobe程序/" target="_blank">使用aya和c混合编写uprobe程序</a></li>
</ul>
</div>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="最后更新">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="2025年9月20日 15:40:54 CST">2025-09-20</span>
  </span>

    
    
    
    
  </aside>


  


  



  <link rel="stylesheet" type="text/css" href="../../stylesheets/auto-number-title.css">
  <h1 id="__comments">评论</h1>
  <!-- Insert generated snippet here -->
  <script src="https://giscus.app/client.js" data-repo="KenForever1/KenForever1.github.io" data-repo-id="R_kgDOGbt1Ww" data-category="Announcements" data-category-id="DIC_kwDOGbt1W84CahvG" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="preferred_color_scheme" data-lang="zh-CN" crossorigin="anonymous" async>
  </script>

  <!-- Synchronize Giscus theme with palette -->
  <script>
    var giscus = document.querySelector("script[src*=giscus]")

    // Set palette on initial load
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
      var theme = palette.color.scheme === "slate"
        ? "transparent_dark"
        : "light"

      // Instruct Giscus to set theme
      giscus.setAttribute("data-theme", theme) 
    }

    // Register event handlers after documented loaded
    document.addEventListener("DOMContentLoaded", function() {
      var ref = document.querySelector("[data-md-component=palette]")
      ref.addEventListener("change", function() {
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
          var theme = palette.color.scheme === "slate"
            ? "transparent_dark"
            : "light"

          // Instruct Giscus to change theme
          var frame = document.querySelector(".giscus-frame")
          frame.contentWindow.postMessage(
            { giscus: { setConfig: { theme } } },
            "https://giscus.app"
          )
        }
      })
    })
  </script>

      
    </article>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
        
      
      <nav class="md-footer__inner md-grid" aria-label="页脚">
        
          
          <a href="../c%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8mix-in%E6%A8%A1%E5%BC%8F%E7%81%B5%E6%B4%BB%E5%8F%AF%E6%89%A9%E5%B1%95%E7%9A%84%E7%BB%84%E5%90%88%E5%8A%9F%E8%83%BD/" class="md-footer__link md-footer__link--prev" aria-label="上一页: c++如何使用Mix-in模式灵活可扩展的组合功能">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                c++如何使用Mix-in模式灵活可扩展的组合功能
              </div>
            </div>
          </a>
        
        
          
          <a href="../%E4%BB%8Edeepseek%E5%BC%80%E6%BA%90%E5%BA%933fs%E4%B8%AD%E5%AD%A6%E4%B9%A0fuse%E7%9A%84%E4%BD%BF%E7%94%A8-%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%80/" class="md-footer__link md-footer__link--next" aria-label="下一页: 从Deepseek开源库3FS中学习fuse的使用-如何开发一个文件系统（一）">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                从Deepseek开源库3FS中学习fuse的使用-如何开发一个文件系统（一）
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <!--
  Copyright (c) 2016-2023 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Copyright and theme information -->
<div class="md-copyright">
  
    <div class="md-copyright__highlight">
      版权所有 © 2025-2025
    </div>
  
  
    <script id="LA-DATA-WIDGET" crossorigin="anonymous" charset="UTF-8" src="https://v6-widget.51.la/v6/3JIbgFniDcGIaNP7/quote.js?theme=#FFFFFF,#808080,#808080,#B3B3B3,#FFFFFF,#1690FF,12&amp;f=12&amp;display=0,0,1,1,1,1,1,1"></script>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://github.com/KenForever1" target="_blank" rel="noopener" title="GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
    </a>
  
    
    
    
    
    <a href="https://www.zhihu.com/people/steveforever" target="_blank" rel="noopener" title="Mastodon" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M170.5 148.1v217.5h23.4l7.7 26.4 42-26.4h49.5V148.1H170.4zM268.3 342h-27.9l-27.9 17.5-5.1-17.5h-11.9V171.7h72.8zm-118.5-94.3H97.5c1.7-27.1 2.2-51.6 2.2-73.5h51.2s2-22.6-8.6-22.3H53.8c3.5-13.1 7.9-26.7 13.1-40.7 0 0-24.1 0-32.3 21.6-3.4 8.9-13.2 43.1-30.7 78.1 5.9-.6 25.4-1.2 36.8-22.2 2.1-5.9 2.5-6.7 5.1-14.5h28.9c0 10.5-1.2 66.9-1.7 73.4H20.7c-11.7 0-15.6 23.6-15.6 23.6h65.6c-4.4 49.9-28 91.9-70.8 125.1 20.5 5.9 40.9-.9 51-9.9 0 0 23-20.9 35.6-69.3l54 64.9s7.9-26.9-1.2-40c-7.6-8.9-28.1-33.1-36.8-41.8L87.9 312c4.4-14 7-27.6 7.9-40.7h61.6s-.1-23.6-7.6-23.6m412-1.6c20.8-25.6 45-58.6 45-58.6s-18.6-14.8-27.4-4.1c-6 8.2-36.8 48.2-36.8 48.2l19.2 14.4zm-150-59.1c-9-8.2-25.9 2.1-25.9 2.1s39.5 55 41.1 57.4l19.5-13.7s-25.7-37.6-34.7-45.9zM640 258.4c-19.8 0-130.9.9-131.1.9v-101q7.2 0 22.8-1.2c40.9-2.4 70.1-4 87.8-4.8 0 0 12.2-27.2-.6-33.4-3.1-1.2-23.2 4.6-23.2 4.6s-165.2 16.5-232.4 18c1.6 8.8 7.6 17.1 15.8 19.6 13.3 3.5 22.7 1.7 49.2.9 24.8-1.6 43.7-2.4 56.5-2.4v99.8H351.3s2.8 22.3 25.5 22.9h107.9v70.9c0 14-11.2 22-24.5 21.1-14.1.1-26.1-1.1-41.7-1.8 2 4 6.3 14.4 19.3 21.8 9.9 4.8 16.2 6.6 26 6.6 29.6 0 45.7-17.3 44.9-45.3v-73.3h122.4c9.7 0 8.7-23.8 8.7-23.8z"></path></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.indexes", "navigation.top", "navigation.sections", "navigation.path", "content.action.edit", "content.action.view", "content.code.copy", "navigation.footer"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../js/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.bootcss.com/mathjax/3.0.5/es5/tex-mml-chtml.js"></script>
      
    
  
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>